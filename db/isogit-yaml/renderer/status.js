import React, { useEffect, useState } from 'react';
import { Button, FormGroup, InputGroup, Popover, Position, ButtonGroup } from '@blueprintjs/core';
import { callIPC, useIPCValue } from '../../../ipc/renderer';
import styles from './status.scss';
const BackendDetails = function ({ dbIPCPrefix, status, description }) {
    const ipcPrefix = dbIPCPrefix;
    const numUncommitted = useIPCValue(`${ipcPrefix}-count-uncommitted`, { numUncommitted: 0 }).
        value.numUncommitted;
    useEffect(() => {
        openPasswordPrompt(status.needsPassword);
    }, [status.needsPassword]);
    const [passwordPromptIsOpen, openPasswordPrompt] = useState(false);
    async function setPassword(password) {
        await callIPC(`${ipcPrefix}-git-set-password`, { password });
    }
    return (React.createElement(Popover, { boundary: "viewport", isOpen: passwordPromptIsOpen, position: Position.BOTTOM, targetTagName: "div", targetClassName: styles.base, content: React.createElement(PasswordPrompt, { onConfirm: async (password) => {
                setPassword(password);
                openPasswordPrompt(false);
            } }) },
        React.createElement(ButtonGroup, { fill: true, vertical: true, alignText: "left" },
            React.createElement(Button, { className: styles.sourceInfo, title: `${description.gitUsername}@${description.gitRepo}`, icon: "git-repo", onClick: () => {
                    if (description.gitRepo) {
                        require('electron').shell.openExternal(description.gitRepo);
                    }
                } },
                description.gitUsername,
                "@",
                description.gitRepo),
            React.createElement(ActionableStatus, { status: status, uncommittedFileCount: numUncommitted, onRequestSync: async () => await callIPC(`${ipcPrefix}-git-trigger-sync`), onDiscardUnstaged: async () => await callIPC(`${ipcPrefix}-git-discard-unstaged`), onPromptPassword: () => openPasswordPrompt(true), onShowCommitWindow: () => callIPC('open-predefined-window', { id: 'batchCommit' }), onShowSettingsWindow: () => callIPC('open-predefined-window', { id: 'settings' }) }))));
};
export default BackendDetails;
const ActionableStatus = function ({ status, uncommittedFileCount, onRequestSync, onDiscardUnstaged, onPromptPassword, onShowCommitWindow, onShowSettingsWindow }) {
    let statusIcon;
    let tooltipText;
    let statusIntent;
    let action;
    if (status.isMisconfigured) {
        statusIcon = "error";
        tooltipText = "Configure";
        statusIntent = "danger";
        action = onShowSettingsWindow;
    }
    else if (status.isOnline !== true) {
        statusIcon = "offline";
        tooltipText = "Offline";
        statusIntent = "danger";
        action = status.needsPassword ? onPromptPassword : onRequestSync;
    }
    else if (status.needsPassword) {
        statusIcon = "lock";
        tooltipText = "Provide password";
        statusIntent = "primary";
        action = onPromptPassword;
    }
    else if (status.hasLocalChanges) {
        statusIcon = "git-commit";
        tooltipText = "Commit outstanding";
        statusIntent = "warning";
        action = async () => {
            if (status.hasLocalChanges && uncommittedFileCount < 1) {
                // NOTE: If hasLocalChanges says yes, but uncommitted file count says no, try to fix it.
                await onDiscardUnstaged();
                await onRequestSync();
            }
            else {
                onShowCommitWindow();
            }
        };
    }
    else if (status.isPulling) {
        statusIcon = "cloud-download";
        tooltipText = "Synchronizing";
        statusIntent = "primary";
        action = null;
    }
    else if (status.isPushing) {
        statusIcon = "cloud-upload";
        tooltipText = "Synchronizing";
        statusIntent = "primary";
        action = null;
    }
    else if (status.statusRelativeToLocal === 'diverged') {
        statusIcon = "git-branch";
        tooltipText = "Diverging changes";
        statusIntent = "danger";
        action = onRequestSync;
    }
    else if (status.statusRelativeToLocal === 'behind') {
        statusIcon = "cloud-upload";
        tooltipText = "Online";
        statusIntent = "warning";
        action = onRequestSync;
    }
    else {
        statusIcon = "updated";
        tooltipText = "Online";
        statusIntent = "success";
        action = onRequestSync;
    }
    return (React.createElement(Button, { className: styles.backendStatus, onClick: action || (() => { }), icon: statusIcon, intent: statusIntent, disabled: action === null, loading: action === null }, tooltipText));
};
const PasswordPrompt = function ({ onConfirm }) {
    const [value, setValue] = useState('');
    return React.createElement("div", { className: styles.passwordPrompt },
        React.createElement(FormGroup, { label: "Please enter repository password:", helperText: "The password will be kept in memory and not stored to disk." },
            React.createElement(InputGroup, { type: "password", value: value, onChange: (event) => setValue(event.target.value), leftIcon: "key", rightElement: value.trim() === ''
                    ? undefined
                    : React.createElement(Button, { minimal: true, onClick: async () => await onConfirm(value), icon: "tick", intent: "primary" }, "Confirm") })));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2RiL2lzb2dpdC15YW1sL3JlbmRlcmVyL3N0YXR1cy50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLEVBQUUsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBRW5ELE9BQU8sRUFBRSxNQUFNLEVBQVksU0FBUyxFQUFFLFVBQVUsRUFBVSxPQUFPLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRXBILE9BQU8sRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFLN0QsT0FBTyxNQUFNLE1BQU0sZUFBZSxDQUFDO0FBR25DLE1BQU0sY0FBYyxHQUNwQixVQUFVLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUU7SUFDNUMsTUFBTSxTQUFTLEdBQUcsV0FBVyxDQUFDO0lBRTlCLE1BQU0sY0FBYyxHQUNsQixXQUFXLENBQUMsR0FBRyxTQUFTLG9CQUFvQixFQUFFLEVBQUUsY0FBYyxFQUFFLENBQUMsRUFBRSxDQUFDO1FBQ3BFLEtBQUssQ0FBQyxjQUFjLENBQUM7SUFFdkIsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUMzQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztJQUUzQixNQUFNLENBQUMsb0JBQW9CLEVBQUUsa0JBQWtCLENBQUMsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7SUFFbkUsS0FBSyxVQUFVLFdBQVcsQ0FBQyxRQUFnQjtRQUN6QyxNQUFNLE9BQU8sQ0FBMEMsR0FBRyxTQUFTLG1CQUFtQixFQUFFLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUN4RyxDQUFDO0lBRUQsT0FBTyxDQUNMLG9CQUFDLE9B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QUNILE9BQU8sUUFDUCxPQUFPLEVBQUUsS0FBSyxJQUFJLEVBQUUsQ0FBQyxNQUFNLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFDM0MsSUFBSSxFQUFDLE1BQU0sRUFDWCxNQUFNLEVBQUMsU0FBUyxjQUVYLEdBQ2IsQ0FDUSxDQUNSLENBQUM7QUFDVCxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHsgQnV0dG9uLCBJY29uTmFtZSwgRm9ybUdyb3VwLCBJbnB1dEdyb3VwLCBJbnRlbnQsIFBvcG92ZXIsIFBvc2l0aW9uLCBCdXR0b25Hcm91cCB9IGZyb20gJ0BibHVlcHJpbnRqcy9jb3JlJztcblxuaW1wb3J0IHsgY2FsbElQQywgdXNlSVBDVmFsdWUgfSBmcm9tICcuLi8uLi8uLi9pcGMvcmVuZGVyZXInO1xuXG5pbXBvcnQgeyBEYXRhYmFzZVN0YXR1c0NvbXBvbmVudFByb3BzIH0gZnJvbSAnLi4vLi4vLi4vY29uZmlnL3JlbmRlcmVyJztcbmltcG9ydCB7IEJhY2tlbmREZXNjcmlwdGlvbiwgQmFja2VuZFN0YXR1cyB9IGZyb20gJy4uL2Jhc2UnO1xuXG5pbXBvcnQgc3R5bGVzIGZyb20gJy4vc3RhdHVzLnNjc3MnO1xuXG5cbmNvbnN0IEJhY2tlbmREZXRhaWxzOiBSZWFjdC5GQzxEYXRhYmFzZVN0YXR1c0NvbXBvbmVudFByb3BzPEJhY2tlbmREZXNjcmlwdGlvbiwgQmFja2VuZFN0YXR1cz4+ID1cbmZ1bmN0aW9uICh7IGRiSVBDUHJlZml4LCBzdGF0dXMsIGRlc2NyaXB0aW9uIH0pIHtcbiAgY29uc3QgaXBjUHJlZml4ID0gZGJJUENQcmVmaXg7XG5cbiAgY29uc3QgbnVtVW5jb21taXR0ZWQgPSBcbiAgICB1c2VJUENWYWx1ZShgJHtpcGNQcmVmaXh9LWNvdW50LXVuY29tbWl0dGVkYCwgeyBudW1VbmNvbW1pdHRlZDogMCB9KS5cbiAgICB2YWx1ZS5udW1VbmNvbW1pdHRlZDtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIG9wZW5QYXNzd29yZFByb21wdChzdGF0dXMubmVlZHNQYXNzd29yZCk7XG4gIH0sIFtzdGF0dXMubmVlZHNQYXNzd29yZF0pO1xuXG4gIGNvbnN0IFtwYXNzd29yZFByb21wdElzT3Blbiwgb3BlblBhc3N3b3JkUHJvbXB0XSA9IHVzZVN0YXRlKGZhbHNlKTtcblxuICBhc3luYyBmdW5jdGlvbiBzZXRQYXNzd29yZChwYXNzd29yZDogc3RyaW5nKSB7XG4gICAgYXdhaXQgY2FsbElQQzx7IHBhc3N3b3JkOiBzdHJpbmcgfSwgeyBzdWNjZXNzOiB0cnVlIH0+KGAke2lwY1ByZWZpeH0tZ2l0LXNldC1wYXNzd29yZGAsIHsgcGFzc3dvcmQgfSk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxQb3BvdmVyXG4gICAgICAgIGJvdW5kYXJ5PVwidmlld3BvcnRcIlxuICAgICAgICBpc09wZW49e3Bhc3N3b3JkUHJvbXB0SXNPcGVufVxuICAgICAgICBwb3NpdGlvbj17UG9zaXRpb24uQk9UVE9NfVxuICAgICAgICB0YXJnZXRUYWdOYW1lPVwiZGl2XCJcbiAgICAgICAgdGFyZ2V0Q2xhc3NOYW1lPXtzdHlsZXMuYmFzZX1cbiAgICAgICAgY29udGVudD17XG4gICAgICAgICAgPFBhc3N3b3JkUHJvbXB0IG9uQ29uZmlybT17YXN5bmMgKHBhc3N3b3JkKSA9PiB7XG4gICAgICAgICAgICBzZXRQYXNzd29yZChwYXNzd29yZCk7XG4gICAgICAgICAgICBvcGVuUGFzc3dvcmRQcm9tcHQoZmFsc2UpO1xuICAgICAgICAgIH19IC8+XG4gICAgICAgIH0+XG4gICAgICA8QnV0dG9uR3JvdXAgZmlsbCB2ZXJ0aWNhbCBhbGlnblRleHQ9XCJsZWZ0XCI+XG4gICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgIGNsYXNzTmFtZT17c3R5bGVzLnNvdXJjZUluZm99XG4gICAgICAgICAgICB0aXRsZT17YCR7ZGVzY3JpcHRpb24uZ2l0VXNlcm5hbWV9QCR7ZGVzY3JpcHRpb24uZ2l0UmVwb31gfVxuICAgICAgICAgICAgaWNvbj1cImdpdC1yZXBvXCJcbiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGRlc2NyaXB0aW9uLmdpdFJlcG8pIHtcbiAgICAgICAgICAgICAgICByZXF1aXJlKCdlbGVjdHJvbicpLnNoZWxsLm9wZW5FeHRlcm5hbChkZXNjcmlwdGlvbi5naXRSZXBvKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfX0+XG4gICAgICAgICAge2Rlc2NyaXB0aW9uLmdpdFVzZXJuYW1lfUB7ZGVzY3JpcHRpb24uZ2l0UmVwb31cbiAgICAgICAgPC9CdXR0b24+XG5cbiAgICAgICAgPEFjdGlvbmFibGVTdGF0dXNcbiAgICAgICAgICBzdGF0dXM9e3N0YXR1c31cbiAgICAgICAgICB1bmNvbW1pdHRlZEZpbGVDb3VudD17bnVtVW5jb21taXR0ZWR9XG4gICAgICAgICAgb25SZXF1ZXN0U3luYz17YXN5bmMgKCkgPT4gYXdhaXQgY2FsbElQQyhgJHtpcGNQcmVmaXh9LWdpdC10cmlnZ2VyLXN5bmNgKX1cbiAgICAgICAgICBvbkRpc2NhcmRVbnN0YWdlZD17YXN5bmMgKCkgPT4gYXdhaXQgY2FsbElQQyhgJHtpcGNQcmVmaXh9LWdpdC1kaXNjYXJkLXVuc3RhZ2VkYCl9XG4gICAgICAgICAgb25Qcm9tcHRQYXNzd29yZD17KCkgPT4gb3BlblBhc3N3b3JkUHJvbXB0KHRydWUpfVxuICAgICAgICAgIG9uU2hvd0NvbW1pdFdpbmRvdz17KCkgPT4gY2FsbElQQygnb3Blbi1wcmVkZWZpbmVkLXdpbmRvdycsIHsgaWQ6ICdiYXRjaENvbW1pdCcgfSl9XG4gICAgICAgICAgb25TaG93U2V0dGluZ3NXaW5kb3c9eygpID0+IGNhbGxJUEMoJ29wZW4tcHJlZGVmaW5lZC13aW5kb3cnLCB7IGlkOiAnc2V0dGluZ3MnIH0pfVxuICAgICAgICAvPlxuICAgICAgPC9CdXR0b25Hcm91cD5cbiAgICA8L1BvcG92ZXI+XG4gICk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBCYWNrZW5kRGV0YWlscztcblxuXG5pbnRlcmZhY2UgQWN0aW9uYWJsZVN0YXR1c1Byb3BzIHtcbiAgc3RhdHVzOiBCYWNrZW5kU3RhdHVzXG4gIHVuY29tbWl0dGVkRmlsZUNvdW50OiBudW1iZXJcbiAgb25SZXF1ZXN0U3luYzogKCkgPT4gUHJvbWlzZTx2b2lkPlxuICBvbkRpc2NhcmRVbnN0YWdlZDogKCkgPT4gUHJvbWlzZTx2b2lkPlxuICBvblByb21wdFBhc3N3b3JkOiAoKSA9PiB2b2lkXG4gIG9uU2hvd0NvbW1pdFdpbmRvdzogKCkgPT4gdm9pZFxuICBvblNob3dTZXR0aW5nc1dpbmRvdzogKCkgPT4gdm9pZFxufVxuY29uc3QgQWN0aW9uYWJsZVN0YXR1czogUmVhY3QuRkM8QWN0aW9uYWJsZVN0YXR1c1Byb3BzPiA9IGZ1bmN0aW9uICh7XG4gICAgc3RhdHVzLCB1bmNvbW1pdHRlZEZpbGVDb3VudCxcbiAgICBvblJlcXVlc3RTeW5jLCBvbkRpc2NhcmRVbnN0YWdlZCxcbiAgICBvblByb21wdFBhc3N3b3JkLFxuICAgIG9uU2hvd0NvbW1pdFdpbmRvdywgb25TaG93U2V0dGluZ3NXaW5kb3cgfSkge1xuXG4gIGxldCBzdGF0dXNJY29uOiBJY29uTmFtZTtcbiAgbGV0IHRvb2x0aXBUZXh0OiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIGxldCBzdGF0dXNJbnRlbnQ6IEludGVudDtcbiAgbGV0IGFjdGlvbjogbnVsbCB8ICgoKSA9PiB2b2lkKTtcblxuICBpZiAoc3RhdHVzLmlzTWlzY29uZmlndXJlZCkge1xuICAgIHN0YXR1c0ljb24gPSBcImVycm9yXCI7XG4gICAgdG9vbHRpcFRleHQgPSBcIkNvbmZpZ3VyZVwiO1xuICAgIHN0YXR1c0ludGVudCA9IFwiZGFuZ2VyXCI7XG4gICAgYWN0aW9uID0gb25TaG93U2V0dGluZ3NXaW5kb3c7XG5cbiAgfSBlbHNlIGlmIChzdGF0dXMuaXNPbmxpbmUgIT09IHRydWUpIHtcbiAgICBzdGF0dXNJY29uID0gXCJvZmZsaW5lXCI7XG4gICAgdG9vbHRpcFRleHQgPSBcIk9mZmxpbmVcIlxuICAgIHN0YXR1c0ludGVudCA9IFwiZGFuZ2VyXCI7XG4gICAgYWN0aW9uID0gc3RhdHVzLm5lZWRzUGFzc3dvcmQgPyBvblByb21wdFBhc3N3b3JkIDogb25SZXF1ZXN0U3luYztcblxuICB9IGVsc2UgaWYgKHN0YXR1cy5uZWVkc1Bhc3N3b3JkKSB7XG4gICAgc3RhdHVzSWNvbiA9IFwibG9ja1wiO1xuICAgIHRvb2x0aXBUZXh0ID0gXCJQcm92aWRlIHBhc3N3b3JkXCI7XG4gICAgc3RhdHVzSW50ZW50ID0gXCJwcmltYXJ5XCI7XG4gICAgYWN0aW9uID0gb25Qcm9tcHRQYXNzd29yZDtcblxuICB9IGVsc2UgaWYgKHN0YXR1cy5oYXNMb2NhbENoYW5nZXMpIHtcbiAgICBzdGF0dXNJY29uID0gXCJnaXQtY29tbWl0XCI7XG4gICAgdG9vbHRpcFRleHQgPSBcIkNvbW1pdCBvdXRzdGFuZGluZ1wiO1xuICAgIHN0YXR1c0ludGVudCA9IFwid2FybmluZ1wiO1xuICAgIGFjdGlvbiA9IGFzeW5jICgpID0+IHtcbiAgICAgIGlmIChzdGF0dXMuaGFzTG9jYWxDaGFuZ2VzICYmIHVuY29tbWl0dGVkRmlsZUNvdW50IDwgMSkge1xuICAgICAgICAvLyBOT1RFOiBJZiBoYXNMb2NhbENoYW5nZXMgc2F5cyB5ZXMsIGJ1dCB1bmNvbW1pdHRlZCBmaWxlIGNvdW50IHNheXMgbm8sIHRyeSB0byBmaXggaXQuXG4gICAgICAgIGF3YWl0IG9uRGlzY2FyZFVuc3RhZ2VkKCk7XG4gICAgICAgIGF3YWl0IG9uUmVxdWVzdFN5bmMoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9uU2hvd0NvbW1pdFdpbmRvdygpO1xuICAgICAgfVxuICAgIH1cblxuICB9IGVsc2UgaWYgKHN0YXR1cy5pc1B1bGxpbmcpIHtcbiAgICBzdGF0dXNJY29uID0gXCJjbG91ZC1kb3dubG9hZFwiXG4gICAgdG9vbHRpcFRleHQgPSBcIlN5bmNocm9uaXppbmdcIjtcbiAgICBzdGF0dXNJbnRlbnQgPSBcInByaW1hcnlcIjtcbiAgICBhY3Rpb24gPSBudWxsO1xuXG4gIH0gZWxzZSBpZiAoc3RhdHVzLmlzUHVzaGluZykge1xuICAgIHN0YXR1c0ljb24gPSBcImNsb3VkLXVwbG9hZFwiXG4gICAgdG9vbHRpcFRleHQgPSBcIlN5bmNocm9uaXppbmdcIjtcbiAgICBzdGF0dXNJbnRlbnQgPSBcInByaW1hcnlcIjtcbiAgICBhY3Rpb24gPSBudWxsO1xuXG4gIH0gZWxzZSBpZiAoc3RhdHVzLnN0YXR1c1JlbGF0aXZlVG9Mb2NhbCA9PT0gJ2RpdmVyZ2VkJykge1xuICAgIHN0YXR1c0ljb24gPSBcImdpdC1icmFuY2hcIlxuICAgIHRvb2x0aXBUZXh0ID0gXCJEaXZlcmdpbmcgY2hhbmdlc1wiO1xuICAgIHN0YXR1c0ludGVudCA9IFwiZGFuZ2VyXCI7XG4gICAgYWN0aW9uID0gb25SZXF1ZXN0U3luYztcblxuICB9IGVsc2UgaWYgKHN0YXR1cy5zdGF0dXNSZWxhdGl2ZVRvTG9jYWwgPT09ICdiZWhpbmQnKSB7XG4gICAgc3RhdHVzSWNvbiA9IFwiY2xvdWQtdXBsb2FkXCJcbiAgICB0b29sdGlwVGV4dCA9IFwiT25saW5lXCI7XG4gICAgc3RhdHVzSW50ZW50ID0gXCJ3YXJuaW5nXCI7XG4gICAgYWN0aW9uID0gb25SZXF1ZXN0U3luYztcblxuICB9IGVsc2Uge1xuICAgIHN0YXR1c0ljb24gPSBcInVwZGF0ZWRcIlxuICAgIHRvb2x0aXBUZXh0ID0gXCJPbmxpbmVcIjtcbiAgICBzdGF0dXNJbnRlbnQgPSBcInN1Y2Nlc3NcIjtcbiAgICBhY3Rpb24gPSBvblJlcXVlc3RTeW5jO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8QnV0dG9uXG4gICAgICAgIGNsYXNzTmFtZT17c3R5bGVzLmJhY2tlbmRTdGF0dXN9XG4gICAgICAgIG9uQ2xpY2s9e2FjdGlvbiB8fCAoKCkgPT4ge30pfVxuICAgICAgICBpY29uPXtzdGF0dXNJY29ufVxuICAgICAgICBpbnRlbnQ9e3N0YXR1c0ludGVudH1cbiAgICAgICAgZGlzYWJsZWQ9e2FjdGlvbiA9PT0gbnVsbH1cbiAgICAgICAgbG9hZGluZz17YWN0aW9uID09PSBudWxsfT5cbiAgICAgIHt0b29sdGlwVGV4dH1cbiAgICA8L0J1dHRvbj5cbiAgKTtcbn07XG5cblxuY29uc3QgUGFzc3dvcmRQcm9tcHQ6IFJlYWN0LkZDPHsgb25Db25maXJtOiAodmFsdWU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPiB9PiA9IGZ1bmN0aW9uICh7IG9uQ29uZmlybSB9KSB7XG4gIGNvbnN0IFt2YWx1ZSwgc2V0VmFsdWVdID0gdXNlU3RhdGUoJycpO1xuXG4gIHJldHVybiA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLnBhc3N3b3JkUHJvbXB0fT5cbiAgICA8Rm9ybUdyb3VwXG4gICAgICAgIGxhYmVsPVwiUGxlYXNlIGVudGVyIHJlcG9zaXRvcnkgcGFzc3dvcmQ6XCJcbiAgICAgICAgaGVscGVyVGV4dD1cIlRoZSBwYXNzd29yZCB3aWxsIGJlIGtlcHQgaW4gbWVtb3J5IGFuZCBub3Qgc3RvcmVkIHRvIGRpc2suXCI+XG4gICAgICA8SW5wdXRHcm91cFxuICAgICAgICB0eXBlPVwicGFzc3dvcmRcIlxuICAgICAgICB2YWx1ZT17dmFsdWV9XG4gICAgICAgIG9uQ2hhbmdlPXsoZXZlbnQ6IFJlYWN0LkZvcm1FdmVudDxIVE1MRWxlbWVudD4pID0+IHNldFZhbHVlKChldmVudC50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWUpfVxuICAgICAgICBsZWZ0SWNvbj1cImtleVwiXG4gICAgICAgIHJpZ2h0RWxlbWVudD17XG4gICAgICAgICAgdmFsdWUudHJpbSgpID09PSAnJ1xuICAgICAgICAgID8gdW5kZWZpbmVkXG4gICAgICAgICAgOiA8QnV0dG9uXG4gICAgICAgICAgICAgICAgbWluaW1hbFxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2FzeW5jICgpID0+IGF3YWl0IG9uQ29uZmlybSh2YWx1ZSl9XG4gICAgICAgICAgICAgICAgaWNvbj1cInRpY2tcIlxuICAgICAgICAgICAgICAgIGludGVudD1cInByaW1hcnlcIj5cbiAgICAgICAgICAgICAgQ29uZmlybVxuICAgICAgICAgICAgPC9CdXR0b24+fVxuICAgICAgLz5cbiAgICA8L0Zvcm1Hcm91cD5cbiAgPC9kaXY+O1xufTtcbiJdfQ==