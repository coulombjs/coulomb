import { listen } from '../../ipc/main';
// Generic backend.
export class Backend {
    setUpIPC(dbID) {
        /* Initializes IPC endpoints to enable the user to e.g. configure the data store
           or invoke housekeeping or utility routines. */
        const prefix = `db-${dbID}`;
        listen(`${prefix}-describe`, async () => {
            return await this.describe();
        });
        listen(`${prefix}-read`, async ({ objectID }) => {
            if (objectID === null) {
                return { object: null };
            }
            else {
                return { object: await this.read(objectID) };
            }
        });
    }
}
// Versioned backend & compatible manager.
export class VersionedBackend extends Backend {
}
export class ModelManager {
    async init() { }
    setUpIPC(modelName) {
        /* Initializes IPC endpoints to query or update data objects. */
        const prefix = `model-${modelName}`;
        listen(`${prefix}-list-ids`, async ({ query }) => ({ ids: (await this.listIDs(query)) }));
        listen(`${prefix}-count`, async ({ query }) => ({ count: await this.count(query) }));
        listen(`${prefix}-read-all`, async ({ query }) => this.readAll(query));
        listen(`${prefix}-read-one`, async ({ objectID }) => {
            if (objectID === null) {
                return { object: null };
            }
            else {
                return { object: await this.read(objectID) };
            }
        });
        listen(`${prefix}-update-one`, async ({ objectID, object, commit }) => {
            await this.update(objectID, object, commit);
            return { success: true };
        });
        listen(`${prefix}-delete-one`, async ({ objectID }) => {
            await this.delete(objectID, true);
            return { success: true };
        });
        listen(`${prefix}-create-one`, async ({ object, commit }) => {
            await this.create(object, commit);
            return { success: true };
        });
    }
}
export class CommitError extends Error {
    constructor(code, msg) {
        super(msg);
        this.code = code;
        Object.setPrototypeOf(this, new.target.prototype);
    }
}
// Versioned backend specifically based on local filesystem,
// and requisite manager interface
export class VersionedFilesystemBackend extends VersionedBackend {
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kYi9tYWluL2Jhc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBSUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBR3hDLG1CQUFtQjtBQUVuQixNQUFNLE9BQWdCLE9BQU87SUE0QjNCLFFBQVEsQ0FBQyxJQUFZO1FBQ25CO3lEQUNpRDtRQUVqRCxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksRUFBRSxDQUFDO1FBRTVCLE1BQU0sQ0FDTCxHQUFHLE1BQU0sV0FBVyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2hDLE9BQU8sTUFBTSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDL0IsQ0FBQyxDQUFDLENBQUM7UUFFSCxNQUFNLENBQ0wsR0FBRyxNQUFNLE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFO1lBQ3hDLElBQUksUUFBUSxLQUFLLElBQUksRUFBRTtnQkFDckIsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQzthQUN6QjtpQkFBTTtnQkFDTCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO2FBQzlDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUEwREQsMENBQTBDO0FBRTFDLE1BQU0sT0FBZ0IsZ0JBQXFDLFNBQVEsT0FBZTtDQVlqRjtBQUdELE1BQU0sT0FBZ0IsWUFBWTtJQW9CaEMsS0FBSyxDQUFDLElBQUksS0FBSSxDQUFDO0lBRWYsUUFBUSxDQUFDLFNBQWlCO1FBQ3hCLGdFQUFnRTtRQUVoRSxNQUFNLE1BQU0sR0FBRyxTQUFTLFNBQVMsRUFBRSxDQUFDO1FBRXBDLE1BQU0sQ0FDTCxHQUFHLE1BQU0sV0FBVyxFQUFFLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFcEYsTUFBTSxDQUNMLEdBQUcsTUFBTSxRQUFRLEVBQUUsS0FBSyxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRS9FLE1BQU0sQ0FDTCxHQUFHLE1BQU0sV0FBVyxFQUFFLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFFakUsTUFBTSxDQUNMLEdBQUcsTUFBTSxXQUFXLEVBQUUsS0FBSyxFQUFFLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRTtZQUM1QyxJQUFJLFFBQVEsS0FBSyxJQUFJLEVBQUU7Z0JBQ3JCLE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7YUFDekI7aUJBQU07Z0JBQ0wsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQzthQUM5QztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsTUFBTSxDQUNMLEdBQUcsTUFBTSxhQUFhLEVBQUUsS0FBSyxFQUFFLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFO1lBQzlELE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQzVDLE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUM7UUFDM0IsQ0FBQyxDQUFDLENBQUM7UUFFSCxNQUFNLENBQ0wsR0FBRyxNQUFNLGFBQWEsRUFBRSxLQUFLLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFO1lBQzlDLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDbEMsT0FBTyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUMzQixDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FDTCxHQUFHLE1BQU0sYUFBYSxFQUFFLEtBQUssRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFO1lBQ3BELE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDbEMsT0FBTyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUMzQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7Q0FDRjtBQUdELE1BQU0sT0FBTyxXQUFZLFNBQVEsS0FBSztJQUNwQyxZQUFtQixJQUFZLEVBQUUsR0FBVztRQUMxQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFETSxTQUFJLEdBQUosSUFBSSxDQUFRO1FBRTdCLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDcEQsQ0FBQztDQUNGO0FBR0QsNERBQTREO0FBQzVELGtDQUFrQztBQUVsQyxNQUFNLE9BQWdCLDBCQUEyQixTQUFRLGdCQUF3QjtDQW9CaEYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBbnlJRFR5cGUsIE1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzJztcbmltcG9ydCB7IFNldHRpbmdNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vc2V0dGluZ3MvbWFpbic7XG5pbXBvcnQgeyBJbmRleCB9IGZyb20gJy4uL3F1ZXJ5JztcbmltcG9ydCB7IEJhY2tlbmREZXNjcmlwdGlvbiB9IGZyb20gJy4uL2Jhc2UnO1xuaW1wb3J0IHsgbGlzdGVuIH0gZnJvbSAnLi4vLi4vaXBjL21haW4nO1xuXG5cbi8vIEdlbmVyaWMgYmFja2VuZC5cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEJhY2tlbmQ8SURUeXBlID0gQW55SURUeXBlPiB7XG4gIGFic3RyYWN0IGluaXQoKTogUHJvbWlzZTx2b2lkPlxuICAvKiBJbml0aWFsaXplcyB0aGUgYmFja2VuZC5cbiAgICAgVGhpcyBtYXkgaW52b2x2ZSBsb2FkaW5nIGRhdGEgZnJvbSByZW1vdGUgc3RvcmFnZSxcbiAgICAgdGh1cyBpbml0aWFsIGF1dGhlbnRpY2F0aW9uLCBldGMuICovXG5cbiAgYWJzdHJhY3QgZGVzY3JpYmUoKTogUHJvbWlzZTxCYWNrZW5kRGVzY3JpcHRpb248YW55Pj5cblxuICAvLyBGb2xsb3dpbmcgYXJlIGRhdGEgcXVlcnkgJiB1cGRhdGUgbWV0aG9kcy5cbiAgLy8gT25lIERCIG1heSBvcGVyYXRlIGEgaGV0ZXJvZ2VuZW91cyBjb2xsZWN0aW9uIG9mIG9iamVjdHMuXG4gIC8vIFJlY29nbml6aW5nIHRoZWlyIHR5cGVzIGlzIG5vdCB3aXRoaW4gREIgYmFja2VuZOKAmXMgc2NvcGUuXG4gIC8vIFRoZXNlIG1ldGhvZHMgcmF0aGVyIG9wZXJhdGUgbG93ZXItbGV2ZWxcbiAgLy8gZ2VuZXJpYyBvYmplY3QgcGF5bG9hZHMgYW5kIG9iamVjdCBJRHMuXG4gIC8vXG4gIC8vIFJlY29nbml6aW5nIHBhcnRpY3VsYXIgZGF0YSB0eXBlcyBpcyBNYW5hZ2Vy4oCZcyBqb2I6XG4gIC8vIHRoZSBhcHAgd291bGQgcXVlcnkgZGF0YSBvYmplY3RzIHZpYSBjb3JyZXNwb25kaW5nIG1hbmFnZXIsXG4gIC8vIHdoaWNoIGluIHR1cm4gd291bGQgY2FsbCB0aGVzZSBtZXRob2RzXG4gIC8vIGZpbGxpbmcgaW4gYXBwcm9wcmlhdGUgYXJndW1lbnRzLlxuXG4gIGFic3RyYWN0IGdldEluZGV4KGlkRmllbGQ6IHN0cmluZywgLi4uYXJnczogYW55W10pOiBQcm9taXNlPEluZGV4PGFueT4+XG4gIC8vIERFUFJFQ0FURUQ6IFJlYWRpbmcgYWxsIERCIG9iamVjdHMgd2l0aG91dCBhbnkgZmlsdGVyaW5nIHF1ZXJ5IHdpbGwgYmUgdG9vIHNsb3cuXG5cbiAgYWJzdHJhY3QgbGlzdElEcyhxdWVyeTogb2JqZWN0KTogUHJvbWlzZTxJRFR5cGVbXT5cbiAgYWJzdHJhY3QgcmVhZChvYmpJRDogSURUeXBlLCAuLi5hcmdzOiBhbnlbXSk6IFByb21pc2U8b2JqZWN0PlxuICBhYnN0cmFjdCBjcmVhdGUob2JqOiBvYmplY3QsIC4uLmFyZ3M6IGFueVtdKTogUHJvbWlzZTx2b2lkPlxuICBhYnN0cmFjdCB1cGRhdGUob2JqSUQ6IElEVHlwZSwgb2JqOiBvYmplY3QsIC4uLmFyZ3M6IGFueVtdKTogUHJvbWlzZTx2b2lkPlxuICBhYnN0cmFjdCBkZWxldGUob2JqSUQ6IElEVHlwZSwgLi4uYXJnczogYW55W10pOiBQcm9taXNlPHZvaWQ+XG5cbiAgc2V0VXBJUEMoZGJJRDogc3RyaW5nKTogdm9pZCB7XG4gICAgLyogSW5pdGlhbGl6ZXMgSVBDIGVuZHBvaW50cyB0byBlbmFibGUgdGhlIHVzZXIgdG8gZS5nLiBjb25maWd1cmUgdGhlIGRhdGEgc3RvcmVcbiAgICAgICBvciBpbnZva2UgaG91c2VrZWVwaW5nIG9yIHV0aWxpdHkgcm91dGluZXMuICovXG5cbiAgICBjb25zdCBwcmVmaXggPSBgZGItJHtkYklEfWA7XG5cbiAgICBsaXN0ZW48e30sIEJhY2tlbmREZXNjcmlwdGlvbjxhbnk+PlxuICAgIChgJHtwcmVmaXh9LWRlc2NyaWJlYCwgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZGVzY3JpYmUoKTtcbiAgICB9KTtcblxuICAgIGxpc3Rlbjx7IG9iamVjdElEOiBJRFR5cGUgfCBudWxsIH0sIHsgb2JqZWN0OiBvYmplY3QgfCBudWxsIH0+XG4gICAgKGAke3ByZWZpeH0tcmVhZGAsIGFzeW5jICh7IG9iamVjdElEIH0pID0+IHtcbiAgICAgIGlmIChvYmplY3RJRCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4geyBvYmplY3Q6IG51bGwgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB7IG9iamVjdDogYXdhaXQgdGhpcy5yZWFkKG9iamVjdElEKSB9O1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG5cblxuZXhwb3J0IHR5cGUgTWFuYWdlZERhdGFDaGFuZ2VSZXBvcnRlcjxJRFR5cGU+ID1cbihjaGFuZ2VkSURzPzogSURUeXBlW10pID0+IFByb21pc2U8dm9pZD47XG4vKiBGdW5jdGlvbiBvZiB0aGlzIHNpZ25hdHVyZSB3aWxsIGJlIHBhc3NlZCB0byBtYW5hZ2VyIGNvbnN0cnVjdG9yLFxuICAgdG8gYmUgY2FsbGVkIHdoZW4gbWFuYWdlciByZXBvcnRzIGRhdGEgdXBkYXRlcyB0byBhcHAgd2luZG93cyxcbiAgIGxldHRpbmcgYW55IG9iamVjdCBsaXN0cyByZS1xdWVyeSB0aGUgZGF0YS5cblxuICAgYGNoYW5nZWRJRHNgIGlzIGludGVuZGVkIHRvIGF2b2lkIHVubmVjZXNzYXJ5IHJlLXF1ZXJ5aW5nLlxuICAgQW4gb2JqZWN0IHJlZmVyZW5jZWQgaW4gaXQgbWF5IGhhdmUgYmVlbiBjcmVhdGVkLFxuICAgbW9kaWZpZWQgb3IgZGVsZXRlZC5cbiAgIFxuICAgTWFuYWdlciBtdXN0IG9taXQgYGNoYW5nZWRJRHNgIGlmIGl0IGlzIG5vdCBzdXJlXG4gICB3aGljaCBleGFjdGx5IG9iamVjdHMgZGlkIGNoYW5nZS4gKi9cblxuXG5leHBvcnQgdHlwZSBCYWNrZW5kU3RhdHVzUmVwb3J0ZXI8U3RhdHVzPiA9XG4ocGF5bG9hZDogUGFydGlhbDxTdGF0dXM+KSA9PiBQcm9taXNlPHZvaWQ+O1xuLyogRnVuY3Rpb24gb2YgdGhpcyBzaWduYXR1cmUgd2lsbCBiZSBwYXNzZWQgdG8gYmFja2VuZCBjb25zdHJ1Y3RvcixcbiAgIHRvIGJlIGNhbGxlZCB3aGVuIGJhY2tlbmQgbmVlZHMgdG8gcmVwb3J0IHN0YXR1cyB0byBhcHAgd2luZG93cy4gKi9cblxuXG5leHBvcnQgaW50ZXJmYWNlIEJhY2tlbmRDbGFzczxcbiAgICBJbml0aWFsT3B0aW9ucyBleHRlbmRzIG9iamVjdCxcbiAgICBPcHRpb25zIGV4dGVuZHMgSW5pdGlhbE9wdGlvbnMsXG4gICAgU3RhdHVzIGV4dGVuZHMgb2JqZWN0PiB7XG4gIC8qIEluaXRpYWwgb3B0aW9ucyBhcmUgc3VwcGxpZWQgYnkgdGhlIGRldmVsb3Blci5cbiAgICAgRnVsbCBvcHRpb25zIGluY2x1ZGUgb3B0aW9ucyBjb25maWd1cmFibGUgYnkgdGhlIHVzZXIsIHNvbWUgb2Ygd2hpY2ggbWF5IGJlIHJlcXVpcmVkLlxuXG4gICAgIE5PVEU6IEJ5IOKAnE9wdGlvbuKAnSwgYmFja2VuZCBjb25zdHJ1Y3RvciBwYXJhbWV0ZXIgaXMgbWVhbnQuXG4gICAgIFRPRE86IFRoaXMgaXMgYSBtaXNub21lciBzaW5jZSBzb21lIG9mIHRob3NlIGFyZSBub24tb3B0aW9uYWwuICovXG5cbiAgbmV3IChcbiAgICBvcHRpb25zOiBPcHRpb25zLFxuICAgIHJlcG9ydEJhY2tlbmRTdGF0dXM6IEJhY2tlbmRTdGF0dXNSZXBvcnRlcjxTdGF0dXM+LFxuICApOiBCYWNrZW5kXG4gIC8vIEJhY2tlbmQgY2xhc3NlcyBhcmUgaW5zdGFudGlhdGVkIGJ5IHRoZSBmcmFtZXdvcmsgZHVyaW5nIGFwcCBpbml0aWFsaXphdGlvbi5cblxuICByZWdpc3RlclNldHRpbmdzRm9yQ29uZmlndXJhYmxlT3B0aW9ucz8oXG4gICAgc2V0dGluZ3M6IFNldHRpbmdNYW5hZ2VyLFxuICAgIGluaXRpYWxPcHRpb25zOiBQYXJ0aWFsPEluaXRpYWxPcHRpb25zPixcbiAgICBkYklEOiBzdHJpbmcpOiB2b2lkXG4gIC8qIEdpdmVuIGluaXRpYWwgb3B0aW9ucyBhbmQgYSBzZXR0aW5ncyBtYW5hZ2VyLFxuICAgICByZWdpc3RlciB1c2VyLWNvbmZpZ3VyYWJsZSBzZXR0aW5ncyB0aGF0IGNvbnRyb2wgdGhpcyBEQuKAmXMgYmVoYXZpb3IuXG4gICAgIFRoaXMgbWV0aG9kIGNhbiBtYWtlIGEgc2V0dGluZyByZXF1aXJlZCBpZiBjb3JyZXNwb25kaW5nIG9wdGlvblxuICAgICBpcyBub3QgcHJvdmlkZWQgYnkgdGhlIGRldmVsb3BlciBpbiB0aGUgaW5pdGlhbCBvcHRpb25zLiAqL1xuXG4gIGNvbXBsZXRlT3B0aW9uc0Zyb21TZXR0aW5ncz8oXG4gICAgc2V0dGluZ3M6IFNldHRpbmdNYW5hZ2VyLFxuICAgIGluaXRpYWxPcHRpb25zOiBQYXJ0aWFsPEluaXRpYWxPcHRpb25zPixcbiAgICBkYklEOiBzdHJpbmcpOiBQcm9taXNlPE9wdGlvbnM+XG4gIC8qIEdpdmVuIGluaXRpYWwgb3B0aW9ucyBhbmQgYSBzZXR0aW5ncyBtYW5hZ2VyLFxuICAgICByZXRyaWV2ZSBhbnkgdXNlci1jb25maWd1cmVkIG9wdGlvbnMgaWYgbmVlZGVkXG4gICAgIGFuZCByZXR1cm4gZnVsbCBvcHRpb25zIG9iamVjdCByZXF1aXJlZCBieSB0aGlzIGJhY2tlbmQuICovXG59XG5cblxuLy8gVmVyc2lvbmVkIGJhY2tlbmQgJiBjb21wYXRpYmxlIG1hbmFnZXIuXG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBWZXJzaW9uZWRCYWNrZW5kPElEVHlwZSA9IEFueUlEVHlwZT4gZXh0ZW5kcyBCYWNrZW5kPElEVHlwZT4ge1xuXG4gIGFic3RyYWN0IGRpc2NhcmQob2JqSURzOiBJRFR5cGVbXSk6IFByb21pc2U8dm9pZD5cbiAgLyogRGlzY2FyZCBhbnkgdW5jb21taXR0ZWQgY2hhbmdlcyBtYWRlIHRvIG9iamVjdHMgd2l0aCBzcGVjaWZpZWQgSURzLiAqL1xuXG4gIGFic3RyYWN0IGNvbW1pdChvYmpJRHM6IElEVHlwZVtdLCBjb21taXRNZXNzYWdlOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+XG4gIC8qIENvbW1pdCBhbnkgdW5jb21taXR0ZWQgY2hhbmdlcyBtYWRlIHRvIG9iamVjdHMgd2l0aCBzcGVjaWZpZWQgSURzLFxuICAgICB3aXRoIHNwZWNpZmllZCBjb21taXQgbWVzc2FnZS4gKi9cblxuICBhYnN0cmFjdCBsaXN0VW5jb21taXR0ZWQ/KCk6IFByb21pc2U8SURUeXBlW10+XG4gIC8qIExpc3QgSURzIG9mIG9iamVjdHMgd2l0aCB1bmNvbW1pdHRlZCBjaGFuZ2VzLiAqL1xuXG59XG5cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIE1vZGVsTWFuYWdlcjxNIGV4dGVuZHMgTW9kZWwsIElEVHlwZSBleHRlbmRzIEFueUlEVHlwZSwgUSBleHRlbmRzIG9iamVjdCA9IG9iamVjdD4ge1xuICAvKiBQYXNzZXMgY2FsbHMgb24gdG8gY29ycmVzcG9uZGluZyBCYWNrZW5kIChvciBzdWJjbGFzcykgbWV0aG9kcyxcbiAgICAgYnV0IGxpbWl0cyB0aGVpciBzY29wZSBvbmx5IHRvIG9iamVjdHMgbWFuaXB1bGF0ZWQgYnkgdGhpcyBtYW5hZ2VyLiAqL1xuXG4gIGFic3RyYWN0IGNvdW50KHF1ZXJ5PzogUSk6IFByb21pc2U8bnVtYmVyPlxuICBhYnN0cmFjdCByZXBvcnRVcGRhdGVkRGF0YTogTWFuYWdlZERhdGFDaGFuZ2VSZXBvcnRlcjxJRFR5cGU+XG5cbiAgYWJzdHJhY3QgbGlzdElEcyhxdWVyeT86IFEpOiBQcm9taXNlPElEVHlwZVtdPlxuICAvLyBUT0RPOiBSZXR1cm5lZCBJRHMgY2Fubm90IGF1dG9tYXRpY2FsbHkgYmUgY2FzdCB0byBJRFR5cGU7XG4gIC8vIGdldCByaWQgb2YgSURUeXBlIGdlbmVyaWMgYW5kIG1hbmFnZSB0eXBlcyBpbiBzdWJjbGFzc2VzP1xuXG4gIGFic3RyYWN0IHJlYWRBbGwocXVlcnk/OiBRKTogUHJvbWlzZTxJbmRleDxNPj5cbiAgYWJzdHJhY3QgcmVhZChpZDogSURUeXBlKTogUHJvbWlzZTxNPlxuICBhYnN0cmFjdCBjcmVhdGUob2JqOiBNLCAuLi5hcmdzOiBhbnlbXSk6IFByb21pc2U8dm9pZD5cbiAgYWJzdHJhY3QgdXBkYXRlKG9iaklEOiBJRFR5cGUsIG9iajogTSwgLi4uYXJnczogYW55W10pOiBQcm9taXNlPHZvaWQ+XG4gIGFic3RyYWN0IGRlbGV0ZShvYmpJRDogSURUeXBlLCAuLi5hcmdzOiB1bmtub3duW10pOiBQcm9taXNlPHZvaWQ+XG5cbiAgcHJvdGVjdGVkIGFic3RyYWN0IGdldERCUmVmKG9iaklEOiBJRFR5cGUgfCBzdHJpbmcpOiBzdHJpbmdcbiAgcHJvdGVjdGVkIGFic3RyYWN0IGdldE9iaklEKGRiUmVmOiBzdHJpbmcpOiBJRFR5cGVcblxuICBhc3luYyBpbml0KCkge31cblxuICBzZXRVcElQQyhtb2RlbE5hbWU6IHN0cmluZykge1xuICAgIC8qIEluaXRpYWxpemVzIElQQyBlbmRwb2ludHMgdG8gcXVlcnkgb3IgdXBkYXRlIGRhdGEgb2JqZWN0cy4gKi9cblxuICAgIGNvbnN0IHByZWZpeCA9IGBtb2RlbC0ke21vZGVsTmFtZX1gO1xuXG4gICAgbGlzdGVuPHsgcXVlcnk/OiBRIH0sIHsgaWRzOiBJRFR5cGVbXSB9PlxuICAgIChgJHtwcmVmaXh9LWxpc3QtaWRzYCwgYXN5bmMgKHsgcXVlcnkgfSkgPT4gKHsgaWRzOiAoYXdhaXQgdGhpcy5saXN0SURzKHF1ZXJ5KSkgfSkpO1xuXG4gICAgbGlzdGVuPHsgcXVlcnk/OiBRIH0sIHsgY291bnQ6IG51bWJlciB9PlxuICAgIChgJHtwcmVmaXh9LWNvdW50YCwgYXN5bmMgKHsgcXVlcnkgfSkgPT4gKHsgY291bnQ6IGF3YWl0IHRoaXMuY291bnQocXVlcnkpIH0pKTtcblxuICAgIGxpc3Rlbjx7IHF1ZXJ5PzogUSB9LCBJbmRleDxNPj5cbiAgICAoYCR7cHJlZml4fS1yZWFkLWFsbGAsIGFzeW5jICh7IHF1ZXJ5IH0pID0+IHRoaXMucmVhZEFsbChxdWVyeSkpO1xuXG4gICAgbGlzdGVuPHsgb2JqZWN0SUQ6IElEVHlwZSB8IG51bGwgfSwgeyBvYmplY3Q6IE0gfCBudWxsIH0+XG4gICAgKGAke3ByZWZpeH0tcmVhZC1vbmVgLCBhc3luYyAoeyBvYmplY3RJRCB9KSA9PiB7XG4gICAgICBpZiAob2JqZWN0SUQgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHsgb2JqZWN0OiBudWxsIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4geyBvYmplY3Q6IGF3YWl0IHRoaXMucmVhZChvYmplY3RJRCkgfTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGxpc3Rlbjx7IG9iamVjdElEOiBJRFR5cGUsIG9iamVjdDogTSwgY29tbWl0OiBib29sZWFuIH0sIHsgc3VjY2VzczogdHJ1ZSB9PlxuICAgIChgJHtwcmVmaXh9LXVwZGF0ZS1vbmVgLCBhc3luYyAoeyBvYmplY3RJRCwgb2JqZWN0LCBjb21taXQgfSkgPT4ge1xuICAgICAgYXdhaXQgdGhpcy51cGRhdGUob2JqZWN0SUQsIG9iamVjdCwgY29tbWl0KTtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9KTtcblxuICAgIGxpc3Rlbjx7IG9iamVjdElEOiBJRFR5cGUgfSwgeyBzdWNjZXNzOiB0cnVlIH0+XG4gICAgKGAke3ByZWZpeH0tZGVsZXRlLW9uZWAsIGFzeW5jICh7IG9iamVjdElEIH0pID0+IHtcbiAgICAgIGF3YWl0IHRoaXMuZGVsZXRlKG9iamVjdElELCB0cnVlKTtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9KTtcblxuICAgIGxpc3Rlbjx7IG9iamVjdDogTSwgY29tbWl0OiBib29sZWFuIH0sIHsgc3VjY2VzczogdHJ1ZSB9PlxuICAgIChgJHtwcmVmaXh9LWNyZWF0ZS1vbmVgLCBhc3luYyAoeyBvYmplY3QsIGNvbW1pdCB9KSA9PiB7XG4gICAgICBhd2FpdCB0aGlzLmNyZWF0ZShvYmplY3QsIGNvbW1pdCk7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSk7XG4gIH1cbn1cblxuXG5leHBvcnQgY2xhc3MgQ29tbWl0RXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBjb2RlOiBzdHJpbmcsIG1zZzogc3RyaW5nKSB7XG4gICAgc3VwZXIobXNnKTtcbiAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcywgbmV3LnRhcmdldC5wcm90b3R5cGUpO1xuICB9XG59XG5cblxuLy8gVmVyc2lvbmVkIGJhY2tlbmQgc3BlY2lmaWNhbGx5IGJhc2VkIG9uIGxvY2FsIGZpbGVzeXN0ZW0sXG4vLyBhbmQgcmVxdWlzaXRlIG1hbmFnZXIgaW50ZXJmYWNlXG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBWZXJzaW9uZWRGaWxlc3lzdGVtQmFja2VuZCBleHRlbmRzIFZlcnNpb25lZEJhY2tlbmQ8c3RyaW5nPiB7XG5cbiAgYWJzdHJhY3QgZ2V0SW5kZXgoaWRGaWVsZDogc3RyaW5nLCBzdWJkaXI6IHN0cmluZywgb25seUlEcz86IHN0cmluZ1tdKTogUHJvbWlzZTxJbmRleDxhbnk+PlxuXG4gIGFic3RyYWN0IHJlZ2lzdGVyTWFuYWdlcihtYW5hZ2VyOiBGaWxlc3lzdGVtTWFuYWdlcik6IHZvaWRcbiAgLyogRW5hYmxlcyBpbnN0YW5jZXMgb2YgdGhpcyBiYWNrZW5kIHRvIGtlZXAgdHJhY2sgb2YgbWFuYWdlcnMsXG4gICAgIHdoaWNoIGlzIHJlcXVpcmVkIGZvciB0aGUgcHVycG9zZSBvZiBleGNsdWRpbmcgZmlsZXNcbiAgICAgY3JlYXRlZCBhcmJpdHJhcmlseSBieSBPUyBvciBvdGhlciBzb2Z0d2FyZVxuICAgICBmcm9tIHZlcnNpb24gY29udHJvbCAoc2VlIGByZXNldE9ycGhhbmVkRmlsZUNoYW5nZXMoKWApLlxuXG4gICAgIE5PVEU6IFNvIGZhciB0aGlzIGlzIHRoZSBvbmx5IHJlYXNvbiBEQiBiYWNrZW5kIG5lZWRzIHRvIGtlZXAgdHJhY2tcbiAgICAgb2YgYXNzb2NpYXRlZCBtYW5hZ2Vycy5cbiAgICAgQ291bGQgREIgYmFja2VuZCBiZSBtYWRlIGF3YXJlIG9mIHdoaWNoIGZpbGVzXG4gICAgIGl04oCZcyByZXNwb25zaWJsZSBmb3I/XG4gICAgIEF2b2lkaW5nIHRoaXMgZGVwZW5kZW5jeSBvbiBtYW5hZ2Vyc1xuICAgICB3b3VsZCBiZSBiZW5lZmljaWFsLCBpZiB0aGVyZeKAmXMgYW4gZWxlZ2FudCB3YXkgb2YgZG9pbmcgaXQuICovXG5cbiAgYWJzdHJhY3QgcmVzZXRPcnBoYW5lZEZpbGVDaGFuZ2VzKCk6IFByb21pc2U8dm9pZD5cbiAgLyogSG91c2VrZWVwaW5nIG1ldGhvZCBmb3IgZmlsZS1iYXNlZCBEQiBiYWNrZW5kLiAqL1xuXG59XG5cblxuZXhwb3J0IGludGVyZmFjZSBGaWxlc3lzdGVtTWFuYWdlciB7XG4gIG1hbmFnZXNGaWxlQXRQYXRoKGZpbGVQYXRoOiBzdHJpbmcpOiBib29sZWFuXG4gIC8qIERldGVybWluZXMgd2hldGhlciB0aGUgbWFuYWdlciBpbnN0YW5jZSBpcyByZXNwb25zaWJsZSBmb3IgdGhlIGZpbGVcbiAgICAgdW5kZXIgZ2l2ZW4gcGF0aC4gKi9cbn1cbiJdfQ==