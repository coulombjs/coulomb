import { listen } from '../../ipc/main';
// Generic backend.
export class Backend {
    setUpIPC(dbID) {
        /* Initializes IPC endpoints to enable the user to e.g. configure the data store
           or invoke housekeeping or utility routines. */
        const prefix = `db-${dbID}`;
        listen(`${prefix}-describe`, async () => {
            return await this.describe();
        });
        listen(`${prefix}-object-exists`, async ({ objID }) => {
            return { exists: await this.exists(objID) };
        });
        listen(`${prefix}-read`, async ({ objID }) => {
            return await this.read(objID);
        });
        listen(`${prefix}-read-raw`, async ({ objID }) => {
            return { contents: await this.readRaw(objID) };
        });
    }
}
// Versioned backend & compatible manager.
export class VersionedBackend extends Backend {
}
export class ModelManager {
    setUpIPC(modelName) {
        /* Initializes IPC endpoints to query or update data objects. */
        const prefix = `model-${modelName}`;
        listen(`${prefix}-list-ids`, async ({ query }) => ({ ids: (await this.listIDs(query)) }));
        listen(`${prefix}-count`, async ({ query }) => ({ count: await this.count(query) }));
        listen(`${prefix}-read-all`, async ({ query }) => this.readAll(query));
        listen(`${prefix}-read-one`, async ({ objectID }) => {
            if (objectID === null) {
                return { object: null };
            }
            else {
                return { object: await this.read(objectID) };
            }
        });
        listen(`${prefix}-update-one`, async ({ objectID, object, commit }) => {
            await this.update(objectID, object, commit);
            return { success: true };
        });
    }
}
export class CommitError extends Error {
    constructor(code, msg) {
        super(msg);
        this.code = code;
        Object.setPrototypeOf(this, new.target.prototype);
    }
}
// Versioned backend specifically based on local filesystem,
// and requisite manager interface
export class VersionedFilesystemBackend extends VersionedBackend {
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kYi9tYWluL2Jhc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBSUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBR3hDLG1CQUFtQjtBQUVuQixNQUFNLE9BQWdCLE9BQU87SUE4QjNCLFFBQVEsQ0FBQyxJQUFZO1FBQ25CO3lEQUNpRDtRQUVqRCxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksRUFBRSxDQUFDO1FBRTVCLE1BQU0sQ0FDTCxHQUFHLE1BQU0sV0FBVyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2hDLE9BQU8sTUFBTSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDL0IsQ0FBQyxDQUFDLENBQUM7UUFFSCxNQUFNLENBQ0wsR0FBRyxNQUFNLGdCQUFnQixFQUFFLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUU7WUFDOUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUM5QyxDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FDTCxHQUFHLE1BQU0sT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUU7WUFDckMsT0FBTyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDaEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxNQUFNLENBQ0wsR0FBRyxNQUFNLFdBQVcsRUFBRSxLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFO1lBQ3pDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDakQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUEwREQsMENBQTBDO0FBRTFDLE1BQU0sT0FBZ0IsZ0JBQXFDLFNBQVEsT0FBZTtDQVlqRjtBQUdELE1BQU0sT0FBZ0IsWUFBWTtJQW9CaEMsUUFBUSxDQUFDLFNBQWlCO1FBQ3hCLGdFQUFnRTtRQUVoRSxNQUFNLE1BQU0sR0FBRyxTQUFTLFNBQVMsRUFBRSxDQUFDO1FBRXBDLE1BQU0sQ0FDTCxHQUFHLE1BQU0sV0FBVyxFQUFFLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFcEYsTUFBTSxDQUNMLEdBQUcsTUFBTSxRQUFRLEVBQUUsS0FBSyxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRS9FLE1BQU0sQ0FDTCxHQUFHLE1BQU0sV0FBVyxFQUFFLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFFakUsTUFBTSxDQUNMLEdBQUcsTUFBTSxXQUFXLEVBQUUsS0FBSyxFQUFFLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRTtZQUM1QyxJQUFJLFFBQVEsS0FBSyxJQUFJLEVBQUU7Z0JBQ3JCLE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7YUFDekI7aUJBQU07Z0JBQ0wsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQzthQUM5QztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsTUFBTSxDQUNMLEdBQUcsTUFBTSxhQUFhLEVBQUUsS0FBSyxFQUFFLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFO1lBQzlELE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQzVDLE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUM7UUFDM0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUFHRCxNQUFNLE9BQU8sV0FBWSxTQUFRLEtBQUs7SUFDcEMsWUFBbUIsSUFBWSxFQUFFLEdBQVc7UUFDMUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRE0sU0FBSSxHQUFKLElBQUksQ0FBUTtRQUU3QixNQUFNLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3BELENBQUM7Q0FDRjtBQUdELDREQUE0RDtBQUM1RCxrQ0FBa0M7QUFFbEMsTUFBTSxPQUFnQiwwQkFBMkIsU0FBUSxnQkFBd0I7Q0FvQmhGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQW55SURUeXBlLCBNb2RlbCB9IGZyb20gJy4uL21vZGVscyc7XG5pbXBvcnQgeyBTZXR0aW5nTWFuYWdlciB9IGZyb20gJy4uLy4uL3NldHRpbmdzL21haW4nO1xuaW1wb3J0IHsgSW5kZXggfSBmcm9tICcuLi9xdWVyeSc7XG5pbXBvcnQgeyBCYWNrZW5kRGVzY3JpcHRpb24gfSBmcm9tICcuLi9iYXNlJztcbmltcG9ydCB7IGxpc3RlbiB9IGZyb20gJy4uLy4uL2lwYy9tYWluJztcblxuXG4vLyBHZW5lcmljIGJhY2tlbmQuXG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBCYWNrZW5kPElEVHlwZSA9IEFueUlEVHlwZT4ge1xuICBhYnN0cmFjdCBpbml0KCk6IFByb21pc2U8dm9pZD5cbiAgLyogSW5pdGlhbGl6ZXMgdGhlIGJhY2tlbmQuXG4gICAgIFRoaXMgbWF5IGludm9sdmUgbG9hZGluZyBkYXRhIGZyb20gcmVtb3RlIHN0b3JhZ2UsXG4gICAgIHRodXMgaW5pdGlhbCBhdXRoZW50aWNhdGlvbiwgZXRjLiAqL1xuXG4gIGFic3RyYWN0IGRlc2NyaWJlKCk6IFByb21pc2U8QmFja2VuZERlc2NyaXB0aW9uPGFueT4+XG5cbiAgLy8gRm9sbG93aW5nIGFyZSBkYXRhIHF1ZXJ5ICYgdXBkYXRlIG1ldGhvZHMuXG4gIC8vIE9uZSBEQiBtYXkgb3BlcmF0ZSBhIGhldGVyb2dlbmVvdXMgY29sbGVjdGlvbiBvZiBvYmplY3RzLlxuICAvLyBSZWNvZ25pemluZyB0aGVpciB0eXBlcyBpcyBub3Qgd2l0aGluIERCIGJhY2tlbmTigJlzIHNjb3BlLlxuICAvLyBUaGVzZSBtZXRob2RzIHJhdGhlciBvcGVyYXRlIGxvd2VyLWxldmVsXG4gIC8vIGdlbmVyaWMgb2JqZWN0IHBheWxvYWRzIGFuZCBvYmplY3QgSURzLlxuICAvL1xuICAvLyBSZWNvZ25pemluZyBwYXJ0aWN1bGFyIGRhdGEgdHlwZXMgaXMgTWFuYWdlcuKAmXMgam9iOlxuICAvLyB0aGUgYXBwIHdvdWxkIHF1ZXJ5IGRhdGEgb2JqZWN0cyB2aWEgY29ycmVzcG9uZGluZyBtYW5hZ2VyLFxuICAvLyB3aGljaCBpbiB0dXJuIHdvdWxkIGNhbGwgdGhlc2UgbWV0aG9kc1xuICAvLyBmaWxsaW5nIGluIGFwcHJvcHJpYXRlIGFyZ3VtZW50cy5cblxuICBhYnN0cmFjdCBnZXRJbmRleChpZEZpZWxkOiBzdHJpbmcsIC4uLmFyZ3M6IGFueVtdKTogUHJvbWlzZTxJbmRleDxhbnk+PlxuICAvLyBERVBSRUNBVEVEOiBSZWFkaW5nIGFsbCBEQiBvYmplY3RzIHdpdGhvdXQgYW55IGZpbHRlcmluZyBxdWVyeSB3aWxsIGJlIHRvbyBzbG93LlxuXG4gIGFic3RyYWN0IGxpc3RJRHMocXVlcnk6IG9iamVjdCk6IFByb21pc2U8SURUeXBlW10+XG4gIGFic3RyYWN0IGV4aXN0cyhvYmpJRDogSURUeXBlKTogUHJvbWlzZTxib29sZWFuPlxuICBhYnN0cmFjdCByZWFkUmF3KG9iaklEOiBJRFR5cGUpOiBQcm9taXNlPHN0cmluZz5cbiAgYWJzdHJhY3QgcmVhZChvYmpJRDogSURUeXBlLCAuLi5hcmdzOiBhbnlbXSk6IFByb21pc2U8b2JqZWN0PlxuICBhYnN0cmFjdCBjcmVhdGUob2JqOiBvYmplY3QsIC4uLmFyZ3M6IGFueVtdKTogUHJvbWlzZTx2b2lkPlxuICBhYnN0cmFjdCB1cGRhdGUob2JqSUQ6IElEVHlwZSwgb2JqOiBvYmplY3QsIC4uLmFyZ3M6IGFueVtdKTogUHJvbWlzZTx2b2lkPlxuICBhYnN0cmFjdCBkZWxldGUob2JqSUQ6IElEVHlwZSwgLi4uYXJnczogYW55W10pOiBQcm9taXNlPHZvaWQ+XG5cbiAgc2V0VXBJUEMoZGJJRDogc3RyaW5nKTogdm9pZCB7XG4gICAgLyogSW5pdGlhbGl6ZXMgSVBDIGVuZHBvaW50cyB0byBlbmFibGUgdGhlIHVzZXIgdG8gZS5nLiBjb25maWd1cmUgdGhlIGRhdGEgc3RvcmVcbiAgICAgICBvciBpbnZva2UgaG91c2VrZWVwaW5nIG9yIHV0aWxpdHkgcm91dGluZXMuICovXG5cbiAgICBjb25zdCBwcmVmaXggPSBgZGItJHtkYklEfWA7XG5cbiAgICBsaXN0ZW48e30sIEJhY2tlbmREZXNjcmlwdGlvbjxhbnk+PlxuICAgIChgJHtwcmVmaXh9LWRlc2NyaWJlYCwgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZGVzY3JpYmUoKTtcbiAgICB9KTtcblxuICAgIGxpc3Rlbjx7IG9iaklEOiBJRFR5cGUgfSwgeyBleGlzdHM6IGJvb2xlYW4gfT5cbiAgICAoYCR7cHJlZml4fS1vYmplY3QtZXhpc3RzYCwgYXN5bmMgKHsgb2JqSUQgfSkgPT4ge1xuICAgICAgcmV0dXJuIHsgZXhpc3RzOiBhd2FpdCB0aGlzLmV4aXN0cyhvYmpJRCkgfTtcbiAgICB9KTtcblxuICAgIGxpc3Rlbjx7IG9iaklEOiBJRFR5cGUgfSwgb2JqZWN0PlxuICAgIChgJHtwcmVmaXh9LXJlYWRgLCBhc3luYyAoeyBvYmpJRCB9KSA9PiB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5yZWFkKG9iaklEKTtcbiAgICB9KTtcblxuICAgIGxpc3Rlbjx7IG9iaklEOiBJRFR5cGUgfSwgeyBjb250ZW50czogc3RyaW5nIH0+XG4gICAgKGAke3ByZWZpeH0tcmVhZC1yYXdgLCBhc3luYyAoeyBvYmpJRCB9KSA9PiB7XG4gICAgICByZXR1cm4geyBjb250ZW50czogYXdhaXQgdGhpcy5yZWFkUmF3KG9iaklEKSB9O1xuICAgIH0pO1xuICB9XG59XG5cblxuZXhwb3J0IHR5cGUgTWFuYWdlZERhdGFDaGFuZ2VSZXBvcnRlcjxJRFR5cGU+ID1cbihjaGFuZ2VkSURzPzogSURUeXBlW10pID0+IFByb21pc2U8dm9pZD47XG4vKiBGdW5jdGlvbiBvZiB0aGlzIHNpZ25hdHVyZSB3aWxsIGJlIHBhc3NlZCB0byBtYW5hZ2VyIGNvbnN0cnVjdG9yLFxuICAgdG8gYmUgY2FsbGVkIHdoZW4gbWFuYWdlciByZXBvcnRzIGRhdGEgdXBkYXRlcyB0byBhcHAgd2luZG93cyxcbiAgIGxldHRpbmcgYW55IG9iamVjdCBsaXN0cyByZS1xdWVyeSB0aGUgZGF0YS5cblxuICAgYGNoYW5nZWRJRHNgIGlzIGludGVuZGVkIHRvIGF2b2lkIHVubmVjZXNzYXJ5IHJlLXF1ZXJ5aW5nLlxuICAgQW4gb2JqZWN0IHJlZmVyZW5jZWQgaW4gaXQgbWF5IGhhdmUgYmVlbiBjcmVhdGVkLFxuICAgbW9kaWZpZWQgb3IgZGVsZXRlZC5cbiAgIFxuICAgTWFuYWdlciBtdXN0IG9taXQgYGNoYW5nZWRJRHNgIGlmIGl0IGlzIG5vdCBzdXJlXG4gICB3aGljaCBleGFjdGx5IG9iamVjdHMgZGlkIGNoYW5nZS4gKi9cblxuXG5leHBvcnQgdHlwZSBCYWNrZW5kU3RhdHVzUmVwb3J0ZXI8U3RhdHVzPiA9XG4ocGF5bG9hZDogUGFydGlhbDxTdGF0dXM+KSA9PiBQcm9taXNlPHZvaWQ+O1xuLyogRnVuY3Rpb24gb2YgdGhpcyBzaWduYXR1cmUgd2lsbCBiZSBwYXNzZWQgdG8gYmFja2VuZCBjb25zdHJ1Y3RvcixcbiAgIHRvIGJlIGNhbGxlZCB3aGVuIGJhY2tlbmQgbmVlZHMgdG8gcmVwb3J0IHN0YXR1cyB0byBhcHAgd2luZG93cy4gKi9cblxuXG5leHBvcnQgaW50ZXJmYWNlIEJhY2tlbmRDbGFzczxcbiAgICBJbml0aWFsT3B0aW9ucyBleHRlbmRzIG9iamVjdCxcbiAgICBPcHRpb25zIGV4dGVuZHMgSW5pdGlhbE9wdGlvbnMsXG4gICAgU3RhdHVzIGV4dGVuZHMgb2JqZWN0PiB7XG4gIC8qIEluaXRpYWwgb3B0aW9ucyBhcmUgc3VwcGxpZWQgYnkgdGhlIGRldmVsb3Blci5cbiAgICAgRnVsbCBvcHRpb25zIGluY2x1ZGUgb3B0aW9ucyBjb25maWd1cmFibGUgYnkgdGhlIHVzZXIsIHNvbWUgb2Ygd2hpY2ggbWF5IGJlIHJlcXVpcmVkLlxuXG4gICAgIE5PVEU6IEJ5IOKAnE9wdGlvbuKAnSwgYmFja2VuZCBjb25zdHJ1Y3RvciBwYXJhbWV0ZXIgaXMgbWVhbnQuXG4gICAgIFRPRE86IFRoaXMgaXMgYSBtaXNub21lciBzaW5jZSBzb21lIG9mIHRob3NlIGFyZSBub24tb3B0aW9uYWwuICovXG5cbiAgbmV3IChcbiAgICBvcHRpb25zOiBPcHRpb25zLFxuICAgIHJlcG9ydEJhY2tlbmRTdGF0dXM6IEJhY2tlbmRTdGF0dXNSZXBvcnRlcjxTdGF0dXM+LFxuICApOiBCYWNrZW5kXG4gIC8vIEJhY2tlbmQgY2xhc3NlcyBhcmUgaW5zdGFudGlhdGVkIGJ5IHRoZSBmcmFtZXdvcmsgZHVyaW5nIGFwcCBpbml0aWFsaXphdGlvbi5cblxuICByZWdpc3RlclNldHRpbmdzRm9yQ29uZmlndXJhYmxlT3B0aW9ucz8oXG4gICAgc2V0dGluZ3M6IFNldHRpbmdNYW5hZ2VyLFxuICAgIGluaXRpYWxPcHRpb25zOiBQYXJ0aWFsPEluaXRpYWxPcHRpb25zPixcbiAgICBkYklEOiBzdHJpbmcpOiB2b2lkXG4gIC8qIEdpdmVuIGluaXRpYWwgb3B0aW9ucyBhbmQgYSBzZXR0aW5ncyBtYW5hZ2VyLFxuICAgICByZWdpc3RlciB1c2VyLWNvbmZpZ3VyYWJsZSBzZXR0aW5ncyB0aGF0IGNvbnRyb2wgdGhpcyBEQuKAmXMgYmVoYXZpb3IuXG4gICAgIFRoaXMgbWV0aG9kIGNhbiBtYWtlIGEgc2V0dGluZyByZXF1aXJlZCBpZiBjb3JyZXNwb25kaW5nIG9wdGlvblxuICAgICBpcyBub3QgcHJvdmlkZWQgYnkgdGhlIGRldmVsb3BlciBpbiB0aGUgaW5pdGlhbCBvcHRpb25zLiAqL1xuXG4gIGNvbXBsZXRlT3B0aW9uc0Zyb21TZXR0aW5ncz8oXG4gICAgc2V0dGluZ3M6IFNldHRpbmdNYW5hZ2VyLFxuICAgIGluaXRpYWxPcHRpb25zOiBQYXJ0aWFsPEluaXRpYWxPcHRpb25zPixcbiAgICBkYklEOiBzdHJpbmcpOiBQcm9taXNlPE9wdGlvbnM+XG4gIC8qIEdpdmVuIGluaXRpYWwgb3B0aW9ucyBhbmQgYSBzZXR0aW5ncyBtYW5hZ2VyLFxuICAgICByZXRyaWV2ZSBhbnkgdXNlci1jb25maWd1cmVkIG9wdGlvbnMgaWYgbmVlZGVkXG4gICAgIGFuZCByZXR1cm4gZnVsbCBvcHRpb25zIG9iamVjdCByZXF1aXJlZCBieSB0aGlzIGJhY2tlbmQuICovXG59XG5cblxuLy8gVmVyc2lvbmVkIGJhY2tlbmQgJiBjb21wYXRpYmxlIG1hbmFnZXIuXG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBWZXJzaW9uZWRCYWNrZW5kPElEVHlwZSA9IEFueUlEVHlwZT4gZXh0ZW5kcyBCYWNrZW5kPElEVHlwZT4ge1xuXG4gIGFic3RyYWN0IGRpc2NhcmQob2JqSURzOiBJRFR5cGVbXSk6IFByb21pc2U8dm9pZD5cbiAgLyogRGlzY2FyZCBhbnkgdW5jb21taXR0ZWQgY2hhbmdlcyBtYWRlIHRvIG9iamVjdHMgd2l0aCBzcGVjaWZpZWQgSURzLiAqL1xuXG4gIGFic3RyYWN0IGNvbW1pdChvYmpJRHM6IElEVHlwZVtdLCBjb21taXRNZXNzYWdlOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+XG4gIC8qIENvbW1pdCBhbnkgdW5jb21taXR0ZWQgY2hhbmdlcyBtYWRlIHRvIG9iamVjdHMgd2l0aCBzcGVjaWZpZWQgSURzLFxuICAgICB3aXRoIHNwZWNpZmllZCBjb21taXQgbWVzc2FnZS4gKi9cblxuICBhYnN0cmFjdCBsaXN0VW5jb21taXR0ZWQ/KCk6IFByb21pc2U8SURUeXBlW10+XG4gIC8qIExpc3QgSURzIG9mIG9iamVjdHMgd2l0aCB1bmNvbW1pdHRlZCBjaGFuZ2VzLiAqL1xuXG59XG5cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIE1vZGVsTWFuYWdlcjxNIGV4dGVuZHMgTW9kZWwsIElEVHlwZSBleHRlbmRzIEFueUlEVHlwZSwgUSBleHRlbmRzIG9iamVjdCA9IG9iamVjdD4ge1xuICAvKiBQYXNzZXMgY2FsbHMgb24gdG8gY29ycmVzcG9uZGluZyBCYWNrZW5kIChvciBzdWJjbGFzcykgbWV0aG9kcyxcbiAgICAgYnV0IGxpbWl0cyB0aGVpciBzY29wZSBvbmx5IHRvIG9iamVjdHMgbWFuaXB1bGF0ZWQgYnkgdGhpcyBtYW5hZ2VyLiAqL1xuXG4gIGFic3RyYWN0IGNvdW50KHF1ZXJ5PzogUSk6IFByb21pc2U8bnVtYmVyPlxuICBhYnN0cmFjdCByZXBvcnRVcGRhdGVkRGF0YTogTWFuYWdlZERhdGFDaGFuZ2VSZXBvcnRlcjxJRFR5cGU+XG5cbiAgYWJzdHJhY3QgbGlzdElEcyhxdWVyeT86IFEpOiBQcm9taXNlPElEVHlwZVtdPlxuICAvLyBUT0RPOiBSZXR1cm5lZCBJRHMgY2Fubm90IGF1dG9tYXRpY2FsbHkgYmUgY2FzdCB0byBJRFR5cGU7XG4gIC8vIGdldCByaWQgb2YgSURUeXBlIGdlbmVyaWMgYW5kIG1hbmFnZSB0eXBlcyBpbiBzdWJjbGFzc2VzP1xuXG4gIGFic3RyYWN0IHJlYWRBbGwocXVlcnk/OiBRKTogUHJvbWlzZTxJbmRleDxNPj5cbiAgYWJzdHJhY3QgcmVhZChpZDogSURUeXBlKTogUHJvbWlzZTxNPlxuICBhYnN0cmFjdCBjcmVhdGUob2JqOiBNLCAuLi5hcmdzOiBhbnlbXSk6IFByb21pc2U8dm9pZD5cbiAgYWJzdHJhY3QgdXBkYXRlKG9iaklEOiBJRFR5cGUsIG9iajogTSwgLi4uYXJnczogYW55W10pOiBQcm9taXNlPHZvaWQ+XG4gIGFic3RyYWN0IGRlbGV0ZShvYmpJRDogSURUeXBlLCAuLi5hcmdzOiB1bmtub3duW10pOiBQcm9taXNlPHZvaWQ+XG5cbiAgcHJvdGVjdGVkIGFic3RyYWN0IGdldERCUmVmKG9iaklEOiBJRFR5cGUgfCBzdHJpbmcpOiBzdHJpbmdcbiAgcHJvdGVjdGVkIGFic3RyYWN0IGdldE9iaklEKGRiUmVmOiBzdHJpbmcpOiBJRFR5cGVcblxuICBzZXRVcElQQyhtb2RlbE5hbWU6IHN0cmluZykge1xuICAgIC8qIEluaXRpYWxpemVzIElQQyBlbmRwb2ludHMgdG8gcXVlcnkgb3IgdXBkYXRlIGRhdGEgb2JqZWN0cy4gKi9cblxuICAgIGNvbnN0IHByZWZpeCA9IGBtb2RlbC0ke21vZGVsTmFtZX1gO1xuXG4gICAgbGlzdGVuPHsgcXVlcnk/OiBRIH0sIHsgaWRzOiBJRFR5cGVbXSB9PlxuICAgIChgJHtwcmVmaXh9LWxpc3QtaWRzYCwgYXN5bmMgKHsgcXVlcnkgfSkgPT4gKHsgaWRzOiAoYXdhaXQgdGhpcy5saXN0SURzKHF1ZXJ5KSkgfSkpO1xuXG4gICAgbGlzdGVuPHsgcXVlcnk/OiBRIH0sIHsgY291bnQ6IG51bWJlciB9PlxuICAgIChgJHtwcmVmaXh9LWNvdW50YCwgYXN5bmMgKHsgcXVlcnkgfSkgPT4gKHsgY291bnQ6IGF3YWl0IHRoaXMuY291bnQocXVlcnkpIH0pKTtcblxuICAgIGxpc3Rlbjx7IHF1ZXJ5PzogUSB9LCBJbmRleDxNPj5cbiAgICAoYCR7cHJlZml4fS1yZWFkLWFsbGAsIGFzeW5jICh7IHF1ZXJ5IH0pID0+IHRoaXMucmVhZEFsbChxdWVyeSkpO1xuXG4gICAgbGlzdGVuPHsgb2JqZWN0SUQ6IElEVHlwZSB8IG51bGwgfSwgeyBvYmplY3Q6IE0gfCBudWxsIH0+XG4gICAgKGAke3ByZWZpeH0tcmVhZC1vbmVgLCBhc3luYyAoeyBvYmplY3RJRCB9KSA9PiB7XG4gICAgICBpZiAob2JqZWN0SUQgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHsgb2JqZWN0OiBudWxsIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4geyBvYmplY3Q6IGF3YWl0IHRoaXMucmVhZChvYmplY3RJRCkgfTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGxpc3Rlbjx7IG9iamVjdElEOiBJRFR5cGUsIG9iamVjdDogTSwgY29tbWl0OiBib29sZWFuIH0sIHsgc3VjY2VzczogdHJ1ZSB9PlxuICAgIChgJHtwcmVmaXh9LXVwZGF0ZS1vbmVgLCBhc3luYyAoeyBvYmplY3RJRCwgb2JqZWN0LCBjb21taXQgfSkgPT4ge1xuICAgICAgYXdhaXQgdGhpcy51cGRhdGUob2JqZWN0SUQsIG9iamVjdCwgY29tbWl0KTtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9KTtcbiAgfVxufVxuXG5cbmV4cG9ydCBjbGFzcyBDb21taXRFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IocHVibGljIGNvZGU6IHN0cmluZywgbXNnOiBzdHJpbmcpIHtcbiAgICBzdXBlcihtc2cpO1xuICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBuZXcudGFyZ2V0LnByb3RvdHlwZSk7XG4gIH1cbn1cblxuXG4vLyBWZXJzaW9uZWQgYmFja2VuZCBzcGVjaWZpY2FsbHkgYmFzZWQgb24gbG9jYWwgZmlsZXN5c3RlbSxcbi8vIGFuZCByZXF1aXNpdGUgbWFuYWdlciBpbnRlcmZhY2VcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFZlcnNpb25lZEZpbGVzeXN0ZW1CYWNrZW5kIGV4dGVuZHMgVmVyc2lvbmVkQmFja2VuZDxzdHJpbmc+IHtcblxuICBhYnN0cmFjdCBnZXRJbmRleChpZEZpZWxkOiBzdHJpbmcsIHN1YmRpcjogc3RyaW5nLCBvbmx5SURzPzogc3RyaW5nW10pOiBQcm9taXNlPEluZGV4PGFueT4+XG5cbiAgYWJzdHJhY3QgcmVnaXN0ZXJNYW5hZ2VyKG1hbmFnZXI6IEZpbGVzeXN0ZW1NYW5hZ2VyKTogdm9pZFxuICAvKiBFbmFibGVzIGluc3RhbmNlcyBvZiB0aGlzIGJhY2tlbmQgdG8ga2VlcCB0cmFjayBvZiBtYW5hZ2VycyxcbiAgICAgd2hpY2ggaXMgcmVxdWlyZWQgZm9yIHRoZSBwdXJwb3NlIG9mIGV4Y2x1ZGluZyBmaWxlc1xuICAgICBjcmVhdGVkIGFyYml0cmFyaWx5IGJ5IE9TIG9yIG90aGVyIHNvZnR3YXJlXG4gICAgIGZyb20gdmVyc2lvbiBjb250cm9sIChzZWUgYHJlc2V0T3JwaGFuZWRGaWxlQ2hhbmdlcygpYCkuXG5cbiAgICAgTk9URTogU28gZmFyIHRoaXMgaXMgdGhlIG9ubHkgcmVhc29uIERCIGJhY2tlbmQgbmVlZHMgdG8ga2VlcCB0cmFja1xuICAgICBvZiBhc3NvY2lhdGVkIG1hbmFnZXJzLlxuICAgICBDb3VsZCBEQiBiYWNrZW5kIGJlIG1hZGUgYXdhcmUgb2Ygd2hpY2ggZmlsZXNcbiAgICAgaXTigJlzIHJlc3BvbnNpYmxlIGZvcj9cbiAgICAgQXZvaWRpbmcgdGhpcyBkZXBlbmRlbmN5IG9uIG1hbmFnZXJzXG4gICAgIHdvdWxkIGJlIGJlbmVmaWNpYWwsIGlmIHRoZXJl4oCZcyBhbiBlbGVnYW50IHdheSBvZiBkb2luZyBpdC4gKi9cblxuICBhYnN0cmFjdCByZXNldE9ycGhhbmVkRmlsZUNoYW5nZXMoKTogUHJvbWlzZTx2b2lkPlxuICAvKiBIb3VzZWtlZXBpbmcgbWV0aG9kIGZvciBmaWxlLWJhc2VkIERCIGJhY2tlbmQuICovXG5cbn1cblxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbGVzeXN0ZW1NYW5hZ2VyIHtcbiAgbWFuYWdlc0ZpbGVBdFBhdGgoZmlsZVBhdGg6IHN0cmluZyk6IGJvb2xlYW5cbiAgLyogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBtYW5hZ2VyIGluc3RhbmNlIGlzIHJlc3BvbnNpYmxlIGZvciB0aGUgZmlsZVxuICAgICB1bmRlciBnaXZlbiBwYXRoLiAqL1xufVxuIl19