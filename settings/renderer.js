import React from 'react';
import { useEffect, useState } from 'react';
import { remote } from 'electron';
import { Button, Tabs, Tab, InputGroup, FormGroup } from '@blueprintjs/core';
import { useIPCValue, callIPC } from '../ipc/renderer';
import styles from './styles.scss';
export function useSetting(name, initialValue) {
    // TODO: Make setting manager send IPC event to renderer when value changed;
    // listen to that event here and relay new value so that widgets are updated.
    // Important if multiple widgets depending on the same setting
    // are shown simultaneously.
    const [localValue, setLocalValue] = useState(initialValue);
    const ipcValue = useIPCValue('settingValue', initialValue, { name });
    useEffect(() => {
        setLocalValue(ipcValue.value);
    }, [ipcValue.value]);
    async function commit() {
        await callIPC('commitSetting', { name, value: localValue });
        ipcValue.refresh();
    }
    return {
        value: localValue,
        // Setting value shown in the widget
        remoteValue: ipcValue.value,
        // Setting value in storage
        changed: () => localValue !== ipcValue.value,
        // True if user manipulated widgetâ€™s local value
        // and the result is different from value in storage
        set: setLocalValue,
        // Updates local value
        commit: commit,
    };
}
const SettingsScreen = function ({ query }) {
    const panes = useIPCValue('settingPaneList', { panes: [] }).
        value.panes;
    const settings = useIPCValue('settingList', { settings: [] }).
        value.settings;
    // Determine whether user was requested to supply specific settings
    let requiredSettingIDs;
    const maybeRequiredSettings = query.get('requiredSettings');
    if (maybeRequiredSettings) {
        requiredSettingIDs = maybeRequiredSettings.split(',');
    }
    else {
        requiredSettingIDs = [];
    }
    let settingWidgetGroup;
    if (requiredSettingIDs.length > 0) {
        settingWidgetGroup = (React.createElement(SettingInputList, { settings: settings.filter(s => requiredSettingIDs.indexOf(s.id) >= 0) }));
    }
    else {
        settingWidgetGroup = (React.createElement(Tabs, null, panes.map(pane => (React.createElement(Tab, { key: pane.id, id: pane.id, title: pane.label, panel: React.createElement(SettingInputList, { settings: settings.filter(s => s.paneID === pane.id) }) })))));
    }
    return React.createElement("div", { className: styles.base }, settingWidgetGroup);
};
const SettingInputList = function ({ settings }) {
    const ipcSettings = settings.map((setting) => useSetting(setting.id, ''));
    const hasChangedSettings = ipcSettings.map((setting) => setting.changed()).indexOf(true) >= 0;
    async function commitAllAndClose() {
        for (const setting of ipcSettings) {
            await setting.commit();
        }
        remote.getCurrentWindow().close();
    }
    return (React.createElement(React.Fragment, null,
        [...ipcSettings.entries()].map(([idx, s]) => React.createElement(SettingInput, { label: settings[idx].label, helpText: settings[idx].helpText, ipcSetting: s, key: idx })),
        hasChangedSettings
            ? React.createElement(Button, { large: true, intent: "primary", onClick: commitAllAndClose }, "Save all and close")
            : null));
};
const SettingInput = function ({ label, ipcSetting, helpText }) {
    return (React.createElement(FormGroup, { label: label, labelFor: "input", helperText: helpText },
        React.createElement(InputGroup, { id: "input", large: true, type: "text", value: ipcSetting.value, onChange: (evt) => {
                ipcSetting.set(evt.target.value);
            }, rightElement: React.createElement(Button, { disabled: !ipcSetting.changed(), onClick: ipcSetting.commit, tabIndex: -1, title: "Save setting", icon: "tick" }, "Save") })));
};
export default SettingsScreen;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2V0dGluZ3MvcmVuZGVyZXIudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMxQixPQUFPLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxNQUFNLE9BQU8sQ0FBQztBQUM1QyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRWxDLE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFJN0UsT0FBTyxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV2RCxPQUFPLE1BQU0sTUFBTSxlQUFlLENBQUM7QUFXbkMsTUFBTSxVQUFVLFVBQVUsQ0FBSSxJQUFZLEVBQUUsWUFBZTtJQUN6RCw0RUFBNEU7SUFDNUUsNkVBQTZFO0lBQzdFLDhEQUE4RDtJQUM5RCw0QkFBNEI7SUFFNUIsTUFBTSxDQUFDLFVBQVUsRUFBRSxhQUFhLENBQUMsR0FBRyxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUM7SUFFM0QsTUFBTSxRQUFRLEdBQUcsV0FBVyxDQUFDLGNBQWMsRUFBRSxZQUFZLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBRXJFLFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYixhQUFhLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2hDLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBRXJCLEtBQUssVUFBVSxNQUFNO1FBQ25CLE1BQU0sT0FBTyxDQUFDLGVBQWUsRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQztRQUM1RCxRQUFRLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDckIsQ0FBQztJ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USxFQUFFLENBQUMsQ0FBQyxFQUNaLEtBQUssRUFBQyxjQUFjLEVBQ3BCLElBQUksRUFBQyxNQUFNLFdBRU4sR0FFWCxDQUNRLENBQ2IsQ0FBQztBQUNKLENBQUMsQ0FBQztBQUdGLGVBQWUsY0FBYyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHVzZUVmZmVjdCwgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyByZW1vdGUgfSBmcm9tICdlbGVjdHJvbic7XG5cbmltcG9ydCB7IEJ1dHRvbiwgVGFicywgVGFiLCBJbnB1dEdyb3VwLCBGb3JtR3JvdXAgfSBmcm9tICdAYmx1ZXByaW50anMvY29yZSc7XG5pbXBvcnQgeyBXaW5kb3dDb21wb25lbnRQcm9wcyB9IGZyb20gJy4uL2NvbmZpZy9yZW5kZXJlcic7XG5cbmltcG9ydCB7IFBhbmUsIFNldHRpbmcgfSBmcm9tICcuLi9zZXR0aW5ncy9tYWluJztcbmltcG9ydCB7IHVzZUlQQ1ZhbHVlLCBjYWxsSVBDIH0gZnJvbSAnLi4vaXBjL3JlbmRlcmVyJztcblxuaW1wb3J0IHN0eWxlcyBmcm9tICcuL3N0eWxlcy5zY3NzJztcblxuXG5pbnRlcmZhY2UgU2V0dGluZ0hvb2s8VD4ge1xuICB2YWx1ZTogVFxuICByZW1vdGVWYWx1ZTogVFxuICBjb21taXQ6ICgpID0+IFByb21pc2U8dm9pZD5cbiAgc2V0OiAodmFsdWU6IFQpID0+IHZvaWRcbiAgY2hhbmdlZDogKCkgPT4gYm9vbGVhblxufVxuXG5leHBvcnQgZnVuY3Rpb24gdXNlU2V0dGluZzxUPihuYW1lOiBzdHJpbmcsIGluaXRpYWxWYWx1ZTogVCk6IFNldHRpbmdIb29rPFQ+IHtcbiAgLy8gVE9ETzogTWFrZSBzZXR0aW5nIG1hbmFnZXIgc2VuZCBJUEMgZXZlbnQgdG8gcmVuZGVyZXIgd2hlbiB2YWx1ZSBjaGFuZ2VkO1xuICAvLyBsaXN0ZW4gdG8gdGhhdCBldmVudCBoZXJlIGFuZCByZWxheSBuZXcgdmFsdWUgc28gdGhhdCB3aWRnZXRzIGFyZSB1cGRhdGVkLlxuICAvLyBJbXBvcnRhbnQgaWYgbXVsdGlwbGUgd2lkZ2V0cyBkZXBlbmRpbmcgb24gdGhlIHNhbWUgc2V0dGluZ1xuICAvLyBhcmUgc2hvd24gc2ltdWx0YW5lb3VzbHkuXG5cbiAgY29uc3QgW2xvY2FsVmFsdWUsIHNldExvY2FsVmFsdWVdID0gdXNlU3RhdGUoaW5pdGlhbFZhbHVlKTtcblxuICBjb25zdCBpcGNWYWx1ZSA9IHVzZUlQQ1ZhbHVlKCdzZXR0aW5nVmFsdWUnLCBpbml0aWFsVmFsdWUsIHsgbmFtZSB9KTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHNldExvY2FsVmFsdWUoaXBjVmFsdWUudmFsdWUpO1xuICB9LCBbaXBjVmFsdWUudmFsdWVdKTtcblxuICBhc3luYyBmdW5jdGlvbiBjb21taXQoKSB7XG4gICAgYXdhaXQgY2FsbElQQygnY29tbWl0U2V0dGluZycsIHsgbmFtZSwgdmFsdWU6IGxvY2FsVmFsdWUgfSk7XG4gICAgaXBjVmFsdWUucmVmcmVzaCgpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB2YWx1ZTogbG9jYWxWYWx1ZSxcbiAgICAvLyBTZXR0aW5nIHZhbHVlIHNob3duIGluIHRoZSB3aWRnZXRcblxuICAgIHJlbW90ZVZhbHVlOiBpcGNWYWx1ZS52YWx1ZSxcbiAgICAvLyBTZXR0aW5nIHZhbHVlIGluIHN0b3JhZ2VcblxuICAgIGNoYW5nZWQ6ICgpID0+IGxvY2FsVmFsdWUgIT09IGlwY1ZhbHVlLnZhbHVlLFxuICAgIC8vIFRydWUgaWYgdXNlciBtYW5pcHVsYXRlZCB3aWRnZXTigJlzIGxvY2FsIHZhbHVlXG4gICAgLy8gYW5kIHRoZSByZXN1bHQgaXMgZGlmZmVyZW50IGZyb20gdmFsdWUgaW4gc3RvcmFnZVxuXG4gICAgc2V0OiBzZXRMb2NhbFZhbHVlLFxuICAgIC8vIFVwZGF0ZXMgbG9jYWwgdmFsdWVcblxuICAgIGNvbW1pdDogY29tbWl0LFxuICAgIC8vIFNhdmVzIGxvY2FsIHZhbHVlIGluIHN0b3JhZ2VcbiAgfTtcbn1cblxuXG5jb25zdCBTZXR0aW5nc1NjcmVlbjogUmVhY3QuRkM8V2luZG93Q29tcG9uZW50UHJvcHM+ID0gZnVuY3Rpb24gKHsgcXVlcnkgfSkge1xuICBjb25zdCBwYW5lcyA9IHVzZUlQQ1ZhbHVlKCdzZXR0aW5nUGFuZUxpc3QnLCB7IHBhbmVzOiBbXSBhcyBQYW5lW10gfSkuXG4gICAgdmFsdWUucGFuZXM7XG4gIGNvbnN0IHNldHRpbmdzID0gdXNlSVBDVmFsdWUoJ3NldHRpbmdMaXN0JywgeyBzZXR0aW5nczogW10gYXMgU2V0dGluZzxhbnk+W10gfSkuXG4gICAgdmFsdWUuc2V0dGluZ3M7XG5cbiAgLy8gRGV0ZXJtaW5lIHdoZXRoZXIgdXNlciB3YXMgcmVxdWVzdGVkIHRvIHN1cHBseSBzcGVjaWZpYyBzZXR0aW5nc1xuICBsZXQgcmVxdWlyZWRTZXR0aW5nSURzOiBzdHJpbmdbXTtcbiAgY29uc3QgbWF5YmVSZXF1aXJlZFNldHRpbmdzID0gcXVlcnkuZ2V0KCdyZXF1aXJlZFNldHRpbmdzJylcbiAgaWYgKG1heWJlUmVxdWlyZWRTZXR0aW5ncykge1xuICAgIHJlcXVpcmVkU2V0dGluZ0lEcyA9IG1heWJlUmVxdWlyZWRTZXR0aW5ncy5zcGxpdCgnLCcpO1xuICB9IGVsc2Uge1xuICAgIHJlcXVpcmVkU2V0dGluZ0lEcyA9IFtdO1xuICB9XG5cbiAgbGV0IHNldHRpbmdXaWRnZXRHcm91cDogSlNYLkVsZW1lbnQ7XG5cbiAgaWYgKHJlcXVpcmVkU2V0dGluZ0lEcy5sZW5ndGggPiAwKSB7XG4gICAgc2V0dGluZ1dpZGdldEdyb3VwID0gKFxuICAgICAgPFNldHRpbmdJbnB1dExpc3RcbiAgICAgICAgc2V0dGluZ3M9e3NldHRpbmdzLmZpbHRlcihzID0+IHJlcXVpcmVkU2V0dGluZ0lEcy5pbmRleE9mKHMuaWQpID49IDApfVxuICAgICAgLz5cbiAgICApO1xuXG4gIH0gZWxzZSB7XG4gICAgc2V0dGluZ1dpZGdldEdyb3VwID0gKFxuICAgICAgPFRhYnM+XG4gICAgICAgIHtwYW5lcy5tYXAocGFuZSA9PiAoXG4gICAgICAgICAgPFRhYlxuICAgICAgICAgICAga2V5PXtwYW5lLmlkfVxuICAgICAgICAgICAgaWQ9e3BhbmUuaWR9XG4gICAgICAgICAgICB0aXRsZT17cGFuZS5sYWJlbH1cbiAgICAgICAgICAgIHBhbmVsPXs8U2V0dGluZ0lucHV0TGlzdCBzZXR0aW5ncz17c2V0dGluZ3MuZmlsdGVyKHMgPT4gcy5wYW5lSUQgPT09IHBhbmUuaWQpfSAvPn1cbiAgICAgICAgICAvPlxuICAgICAgICApKX1cbiAgICAgIDwvVGFicz5cbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPXtzdHlsZXMuYmFzZX0+e3NldHRpbmdXaWRnZXRHcm91cH08L2Rpdj47XG59O1xuXG5cbmNvbnN0IFNldHRpbmdJbnB1dExpc3Q6IFJlYWN0LkZDPHsgc2V0dGluZ3M6IFNldHRpbmc8YW55PltdIH0+ID0gZnVuY3Rpb24gKHsgc2V0dGluZ3MgfSkge1xuICBjb25zdCBpcGNTZXR0aW5ncyA9IHNldHRpbmdzLm1hcCgoc2V0dGluZykgPT4gdXNlU2V0dGluZzxzdHJpbmc+KHNldHRpbmcuaWQsICcnKSk7XG4gIGNvbnN0IGhhc0NoYW5nZWRTZXR0aW5ncyA9IGlwY1NldHRpbmdzLm1hcCgoc2V0dGluZykgPT4gc2V0dGluZy5jaGFuZ2VkKCkpLmluZGV4T2YodHJ1ZSkgPj0gMDtcblxuICBhc3luYyBmdW5jdGlvbiBjb21taXRBbGxBbmRDbG9zZSgpIHtcbiAgICBmb3IgKGNvbnN0IHNldHRpbmcgb2YgaXBjU2V0dGluZ3MpIHtcbiAgICAgIGF3YWl0IHNldHRpbmcuY29tbWl0KCk7XG4gICAgfVxuICAgIHJlbW90ZS5nZXRDdXJyZW50V2luZG93KCkuY2xvc2UoKTtcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPD5cbiAgICAgIHtbLi4uaXBjU2V0dGluZ3MuZW50cmllcygpXS5tYXAoKFtpZHgsIHNdOiBbbnVtYmVyLCBTZXR0aW5nSG9vazxhbnk+XSkgPT5cbiAgICAgICAgPFNldHRpbmdJbnB1dFxuICAgICAgICAgIGxhYmVsPXtzZXR0aW5nc1tpZHhdLmxhYmVsfVxuICAgICAgICAgIGhlbHBUZXh0PXtzZXR0aW5nc1tpZHhdLmhlbHBUZXh0fVxuICAgICAgICAgIGlwY1NldHRpbmc9e3N9XG4gICAgICAgICAga2V5PXtpZHh9XG4gICAgICAgIC8+KX1cbiAgICAgIHtoYXNDaGFuZ2VkU2V0dGluZ3NcbiAgICAgICAgPyA8QnV0dG9uIGxhcmdlIGludGVudD1cInByaW1hcnlcIiBvbkNsaWNrPXtjb21taXRBbGxBbmRDbG9zZX0+U2F2ZSBhbGwgYW5kIGNsb3NlPC9CdXR0b24+XG4gICAgICAgIDogbnVsbH1cbiAgICA8Lz5cbiAgKTtcbn07XG5cblxuaW50ZXJmYWNlIFNldHRpbmdzSW5wdXRQcm9wcyB7XG4gIGxhYmVsOiBzdHJpbmdcbiAgaXBjU2V0dGluZzogU2V0dGluZ0hvb2s8YW55PiBcbiAgaGVscFRleHQ/OiBzdHJpbmdcbn1cbmNvbnN0IFNldHRpbmdJbnB1dDogUmVhY3QuRkM8U2V0dGluZ3NJbnB1dFByb3BzPiA9IGZ1bmN0aW9uICh7IGxhYmVsLCBpcGNTZXR0aW5nLCBoZWxwVGV4dCB9KSB7XG4gIHJldHVybiAoXG4gICAgPEZvcm1Hcm91cCBsYWJlbD17bGFiZWx9IGxhYmVsRm9yPVwiaW5wdXRcIiBoZWxwZXJUZXh0PXtoZWxwVGV4dH0+XG4gICAgICA8SW5wdXRHcm91cFxuICAgICAgICBpZD1cImlucHV0XCJcbiAgICAgICAgbGFyZ2VcbiAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICB2YWx1ZT17aXBjU2V0dGluZy52YWx1ZX1cbiAgICAgICAgb25DaGFuZ2U9eyhldnQ6IFJlYWN0LkZvcm1FdmVudDxIVE1MRWxlbWVudD4pID0+IHtcbiAgICAgICAgICBpcGNTZXR0aW5nLnNldCgoZXZ0LnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KS52YWx1ZSBhcyBzdHJpbmcpO1xuICAgICAgICB9fVxuICAgICAgICByaWdodEVsZW1lbnQ9e1xuICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgZGlzYWJsZWQ9eyFpcGNTZXR0aW5nLmNoYW5nZWQoKX1cbiAgICAgICAgICAgICAgb25DbGljaz17aXBjU2V0dGluZy5jb21taXR9XG4gICAgICAgICAgICAgIHRhYkluZGV4PXstMX1cbiAgICAgICAgICAgICAgdGl0bGU9XCJTYXZlIHNldHRpbmdcIlxuICAgICAgICAgICAgICBpY29uPVwidGlja1wiPlxuICAgICAgICAgICAgU2F2ZVxuICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICB9XG4gICAgICAvPlxuICAgIDwvRm9ybUdyb3VwPlxuICApO1xufTtcblxuXG5leHBvcnQgZGVmYXVsdCBTZXR0aW5nc1NjcmVlbjsiXX0=